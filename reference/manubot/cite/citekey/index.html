



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.6.3">
    
    
      
        <title>Citekey - manubot</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#module-manubotcitecitekey" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="manubot" aria-label="manubot" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              manubot
            </span>
            <span class="md-header-nav__topic">
              
                Citekey
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/manubot/manubot/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    manubot
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="manubot" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    manubot
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/manubot/manubot/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    manubot
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../LICENSE/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      Manubot
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Manubot
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../command/" title="Command" class="md-nav__link">
      Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../util/" title="Util" class="md-nav__link">
      Util
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-4" type="checkbox" id="nav-3-1-4" checked>
    
    <label class="md-nav__link" for="nav-3-1-4">
      Cite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-4">
        Cite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../arxiv/" title="Arxiv" class="md-nav__link">
      Arxiv
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cite_command/" title="Cite Command" class="md-nav__link">
      Cite Command
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Citekey
      </label>
    
    <a href="./" title="Citekey" class="md-nav__link md-nav__link--active">
      Citekey
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citekey_to_csl_item" class="md-nav__link">
    citekey_to_csl_item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_citekey_prefix" class="md-nav__link">
    infer_citekey_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_citekey" class="md-nav__link">
    is_valid_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shorten_citekey" class="md-nav__link">
    shorten_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standardize_citekey" class="md-nav__link">
    standardize_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_to_citekey" class="md-nav__link">
    url_to_citekey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citekey" class="md-nav__link">
    CiteKey
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check_input_id" class="md-nav__link">
    check_input_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_input_id" class="md-nav__link">
    from_input_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#all_ids" class="md-nav__link">
    all_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csl_item" class="md-nav__link">
    csl_item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dealiased_id" class="md-nav__link">
    dealiased_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler" class="md-nav__link">
    handler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect" class="md-nav__link">
    inspect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_handled_prefix" class="md-nav__link">
    is_handled_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_pandoc_xnos_prefix" class="md-nav__link">
    is_pandoc_xnos_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#short_id" class="md-nav__link">
    short_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../citeproc/" title="Citeproc" class="md-nav__link">
      Citeproc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../csl_item/" title="Csl Item" class="md-nav__link">
      Csl Item
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curie/" title="Curie" class="md-nav__link">
      Curie
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../doi/" title="Doi" class="md-nav__link">
      Doi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../handlers/" title="Handlers" class="md-nav__link">
      Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../isbn/" title="Isbn" class="md-nav__link">
      Isbn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pubmed/" title="Pubmed" class="md-nav__link">
      Pubmed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unpaywall/" title="Unpaywall" class="md-nav__link">
      Unpaywall
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../url/" title="Url" class="md-nav__link">
      Url
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wikidata/" title="Wikidata" class="md-nav__link">
      Wikidata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zotero/" title="Zotero" class="md-nav__link">
      Zotero
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-4-16" type="checkbox" id="nav-3-1-4-16">
    
    <label class="md-nav__link" for="nav-3-1-4-16">
      Tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-3-1-4-16">
        Tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_arxiv/" title="Test Arxiv" class="md-nav__link">
      Test Arxiv
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_cite_command/" title="Test Cite Command" class="md-nav__link">
      Test Cite Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_citekey/" title="Test Citekey" class="md-nav__link">
      Test Citekey
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_citekey_api/" title="Test Citekey Api" class="md-nav__link">
      Test Citekey Api
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_citeproc/" title="Test Citeproc" class="md-nav__link">
      Test Citeproc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_csl_item/" title="Test Csl Item" class="md-nav__link">
      Test Csl Item
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_curie/" title="Test Curie" class="md-nav__link">
      Test Curie
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_doi/" title="Test Doi" class="md-nav__link">
      Test Doi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_handlers/" title="Test Handlers" class="md-nav__link">
      Test Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_isbn/" title="Test Isbn" class="md-nav__link">
      Test Isbn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_pubmed/" title="Test Pubmed" class="md-nav__link">
      Test Pubmed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_unpaywall/" title="Test Unpaywall" class="md-nav__link">
      Test Unpaywall
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_url/" title="Test Url" class="md-nav__link">
      Test Url
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_wikidata/" title="Test Wikidata" class="md-nav__link">
      Test Wikidata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_zotero/" title="Test Zotero" class="md-nav__link">
      Test Zotero
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-5" type="checkbox" id="nav-3-1-5">
    
    <label class="md-nav__link" for="nav-3-1-5">
      Pandoc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-5">
        Pandoc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/bibliography/" title="Bibliography" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/cite_filter/" title="Cite Filter" class="md-nav__link">
      Cite Filter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/util/" title="Util" class="md-nav__link">
      Util
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-6" type="checkbox" id="nav-3-1-6">
    
    <label class="md-nav__link" for="nav-3-1-6">
      Process
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-6">
        Process
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/bibliography/" title="Bibliography" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/ci/" title="Ci" class="md-nav__link">
      Ci
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/manuscript/" title="Manuscript" class="md-nav__link">
      Manuscript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/metadata/" title="Metadata" class="md-nav__link">
      Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/process_command/" title="Process Command" class="md-nav__link">
      Process Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/util/" title="Util" class="md-nav__link">
      Util
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-6-8" type="checkbox" id="nav-3-1-6-8">
    
    <label class="md-nav__link" for="nav-3-1-6-8">
      Tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-3-1-6-8">
        Tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_bibliography/" title="Test Bibliography" class="md-nav__link">
      Test Bibliography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_ci/" title="Test Ci" class="md-nav__link">
      Test Ci
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_metadata/" title="Test Metadata" class="md-nav__link">
      Test Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_process_command/" title="Test Process Command" class="md-nav__link">
      Test Process Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_util/" title="Test Util" class="md-nav__link">
      Test Util
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-7" type="checkbox" id="nav-3-1-7">
    
    <label class="md-nav__link" for="nav-3-1-7">
      Tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-7">
        Tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_command/" title="Test Command" class="md-nav__link">
      Test Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_imports/" title="Test Imports" class="md-nav__link">
      Test Imports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_readme/" title="Test Readme" class="md-nav__link">
      Test Readme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_util/" title="Test Util" class="md-nav__link">
      Test Util
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-8" type="checkbox" id="nav-3-1-8">
    
    <label class="md-nav__link" for="nav-3-1-8">
      Webpage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-8">
        Webpage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../webpage/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webpage/webpage_command/" title="Webpage Command" class="md-nav__link">
      Webpage Command
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citekey_to_csl_item" class="md-nav__link">
    citekey_to_csl_item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_citekey_prefix" class="md-nav__link">
    infer_citekey_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_citekey" class="md-nav__link">
    is_valid_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shorten_citekey" class="md-nav__link">
    shorten_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standardize_citekey" class="md-nav__link">
    standardize_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_to_citekey" class="md-nav__link">
    url_to_citekey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citekey" class="md-nav__link">
    CiteKey
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check_input_id" class="md-nav__link">
    check_input_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_input_id" class="md-nav__link">
    from_input_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#all_ids" class="md-nav__link">
    all_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csl_item" class="md-nav__link">
    csl_item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dealiased_id" class="md-nav__link">
    dealiased_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler" class="md-nav__link">
    handler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect" class="md-nav__link">
    inspect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_handled_prefix" class="md-nav__link">
    is_handled_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_pandoc_xnos_prefix" class="md-nav__link">
    is_pandoc_xnos_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#short_id" class="md-nav__link">
    short_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/manubot/manubot/edit/master/reference/manubot/cite/citekey.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="module-manubotcitecitekey">Module manubot.cite.citekey</h1>
<p>Utilities for representing and processing citation keys.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">Utilities for representing and processing citation keys.</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">functools</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">logging</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">re</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">dataclasses</span>

<span class="nn">try</span><span class="p">:</span>

    <span class="s s-Atom">from</span> <span class="s s-Atom">functools</span> <span class="s s-Atom">import</span> <span class="s s-Atom">cached_property</span>

<span class="s s-Atom">except</span> <span class="nv">ImportError</span><span class="s s-Atom">:</span>

    <span class="s s-Atom">from</span> <span class="s s-Atom">backports</span><span class="p">.</span><span class="s s-Atom">cached_property</span> <span class="s s-Atom">import</span> <span class="s s-Atom">cached_property</span>

<span class="s s-Atom">@dataclasses</span><span class="p">.</span><span class="s s-Atom">dataclass</span>

<span class="s s-Atom">class</span> <span class="nv">CiteKey</span><span class="s s-Atom">:</span>

    <span class="s s-Atom">input_id:</span> <span class="s s-Atom">str</span>

    <span class="nn">aliases</span><span class="p">:</span> <span class="s s-Atom">dict</span> <span class="o">=</span> <span class="s s-Atom">dataclasses</span><span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="s s-Atom">default_factory</span><span class="o">=</span><span class="s s-Atom">dict</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">post_init__</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">check_input_id</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">input_id</span><span class="p">)</span>

    <span class="s s-Atom">@staticmethod</span>

    <span class="s s-Atom">def</span> <span class="nf">check_input_id</span><span class="p">(</span><span class="s s-Atom">input_id</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">input_id</span><span class="p">,</span> <span class="s s-Atom">str</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">raise</span> <span class="nv">TypeError</span><span class="p">(</span>

                <span class="s2">&quot;input_id should be type &#39;str&#39; not &quot;</span>

                <span class="s s-Atom">f</span><span class="s2">&quot;{type(input_id).__name__!r}: {input_id!r}&quot;</span>

            <span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">input_id</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;invalid citekey input_id: {input_id!r}\nstarts with &#39;@&#39;&quot;</span>

    <span class="s s-Atom">@classmethod</span>

    <span class="s s-Atom">@functools</span><span class="p">.</span><span class="nf">lru_cache</span><span class="p">(</span><span class="s s-Atom">maxsize</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">from_input_id</span><span class="p">(</span><span class="s s-Atom">cls</span><span class="p">,</span> <span class="o">*</span><span class="s s-Atom">args</span><span class="p">,</span> <span class="s s-Atom">**kwargs</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s2">&quot;&quot;&quot;Cached constructor&quot;&quot;&quot;</span>

        <span class="s s-Atom">return</span> <span class="nf">cls</span><span class="p">(</span><span class="o">*</span><span class="s s-Atom">args</span><span class="p">,</span> <span class="s s-Atom">**kwargs</span><span class="p">)</span>

    <span class="s s-Atom">@cached_property</span>

    <span class="s s-Atom">def</span> <span class="nf">dealiased_id</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">aliases</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">input_id</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">input_id</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="k">_</span><span class="nf">set_prefix_accession</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="nn">try</span><span class="p">:</span>

            <span class="s s-Atom">prefix</span><span class="p">,</span> <span class="s s-Atom">accession</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">dealiased_id</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="s s-Atom">except</span> <span class="nv">ValueError</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">prefix</span><span class="p">,</span> <span class="s s-Atom">accession</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span> <span class="nv">None</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">prefix</span> <span class="o">=</span> <span class="s s-Atom">prefix</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">accession</span> <span class="o">=</span> <span class="s s-Atom">accession</span>

    <span class="s s-Atom">@property</span>

    <span class="s s-Atom">def</span> <span class="nf">prefix</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s2">&quot;_prefix&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="nf">set_prefix_accession</span><span class="p">()</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">prefix</span>

    <span class="s s-Atom">@property</span>

    <span class="s s-Atom">def</span> <span class="nf">prefix_lower</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>

    <span class="s s-Atom">@property</span>

    <span class="s s-Atom">def</span> <span class="nf">accession</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s2">&quot;_accession&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="nf">set_prefix_accession</span><span class="p">()</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">accession</span>

    <span class="s s-Atom">@property</span>

    <span class="s s-Atom">def</span> <span class="nf">standard_prefix</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s2">&quot;_standard_prefix&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="nf">standardize</span><span class="p">()</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_prefix</span>

    <span class="s s-Atom">@property</span>

    <span class="s s-Atom">def</span> <span class="nf">standard_accession</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s2">&quot;_standard_accession&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="nf">standardize</span><span class="p">()</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_accession</span>

    <span class="s s-Atom">@cached_property</span>

    <span class="s s-Atom">def</span> <span class="nf">handler</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">handlers</span> <span class="s s-Atom">import</span> <span class="nv">Handler</span><span class="p">,</span> <span class="s s-Atom">get_handler</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">is_handled_prefix:</span>

            <span class="s s-Atom">return</span> <span class="nf">get_handler</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span><span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">Handler</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span><span class="p">)</span>

    <span class="s s-Atom">@cached_property</span>

    <span class="s s-Atom">def</span> <span class="nf">is_handled_prefix</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">handlers</span> <span class="s s-Atom">import</span> <span class="s s-Atom">prefix_to_handler</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span> <span class="s s-Atom">in</span> <span class="s s-Atom">prefix_to_handler</span>

    <span class="s s-Atom">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">handler</span><span class="p">.</span><span class="nf">inspect</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="k">_</span><span class="nf">standardize</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span> <span class="o">is</span> <span class="nv">None</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_prefix</span> <span class="o">=</span> <span class="nv">None</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_accession</span> <span class="o">=</span> <span class="nv">None</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_id</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">dealiased_id</span>

            <span class="nf">return</span>

        <span class="p">(</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_prefix</span><span class="p">,</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_accession</span><span class="p">,</span>

        <span class="p">)</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">handler</span><span class="p">.</span><span class="nf">standardize_prefix_accession</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">accession</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_id</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;{self._standard_prefix}:{self._standard_accession}&quot;</span>

    <span class="s s-Atom">@property</span>

    <span class="s s-Atom">def</span> <span class="nf">standard_id</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s2">&quot;_standard_id&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="nf">standardize</span><span class="p">()</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="k">_</span><span class="s s-Atom">standard_id</span>

    <span class="s s-Atom">@cached_property</span>

    <span class="s s-Atom">def</span> <span class="nf">short_id</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">return</span> <span class="nf">shorten_citekey</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">standard_id</span><span class="p">)</span>

    <span class="s s-Atom">@cached_property</span>

    <span class="s s-Atom">def</span> <span class="nf">all_ids</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">input_id</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">dealiased_id</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">standard_id</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">short_id</span><span class="p">]</span>

        <span class="s s-Atom">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">x</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="s s-Atom">ids</span> <span class="s s-Atom">if</span> <span class="s s-Atom">x</span><span class="p">]</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">remove</span> <span class="nv">None</span>

        <span class="s s-Atom">ids</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s s-Atom">dict</span><span class="p">.</span><span class="nf">fromkeys</span><span class="p">(</span><span class="s s-Atom">ids</span><span class="p">))</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">deduplicate</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">ids</span>

    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">hash__</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">return</span> <span class="nf">hash</span><span class="p">((</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">input_id</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">dealiased_id</span><span class="p">))</span>

    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">repr__</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">return</span> <span class="s2">&quot; --&gt; &quot;</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;{getattr(self, key)} ({key})&quot;</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">key</span> <span class="nf">in</span> <span class="p">(</span>

                <span class="s2">&quot;input_id&quot;</span><span class="p">,</span>

                <span class="s2">&quot;dealiased_id&quot;</span><span class="p">,</span>

                <span class="s2">&quot;prefix_lower&quot;</span><span class="p">,</span>

                <span class="s2">&quot;accession&quot;</span><span class="p">,</span>

                <span class="s2">&quot;standard_id&quot;</span><span class="p">,</span>

                <span class="s2">&quot;short_id&quot;</span><span class="p">,</span>

            <span class="p">)</span>

        <span class="p">)</span>

    <span class="s s-Atom">@cached_property</span>

    <span class="s s-Atom">def</span> <span class="nf">csl_item</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">csl_item</span> <span class="s s-Atom">import</span> <span class="nv">CSL_Item</span>

        <span class="s s-Atom">csl_item</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">handler</span><span class="p">.</span><span class="nf">get_csl_item</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">csl_item</span><span class="p">,</span> <span class="nv">CSL_Item</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">csl_item</span> <span class="o">=</span> <span class="nv">CSL_Item</span><span class="p">(</span><span class="s s-Atom">csl_item</span><span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">csl_item</span>

    <span class="s s-Atom">def</span> <span class="nf">is_pandoc_xnos_prefix</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">log_case_warning</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">handlers</span> <span class="s s-Atom">import</span> <span class="k">_</span><span class="s s-Atom">pandoc_xnos_prefixes</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix</span> <span class="s s-Atom">in</span> <span class="k">_</span><span class="s s-Atom">pandoc_xnos_prefixes:</span>

            <span class="s s-Atom">return</span> <span class="nv">True</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">log_case_warning</span> <span class="s s-Atom">and</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span> <span class="s s-Atom">in</span> <span class="k">_</span><span class="s s-Atom">pandoc_xnos_prefixes:</span>

            <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span>

                <span class="s2">&quot;pandoc-xnos prefixes should be all lowercase.\n&quot;</span>

                <span class="s s-Atom">f&#39;Should {self.input_id!r} use {self.prefix_lower!r} rather than &quot;{self.prefix!r}&quot;?&#39;</span>

            <span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">False</span>

<span class="s s-Atom">@functools</span><span class="p">.</span><span class="nf">lru_cache</span><span class="p">(</span><span class="s s-Atom">maxsize</span><span class="o">=</span><span class="mi">5</span><span class="k">_</span><span class="mi">000</span><span class="p">)</span>

<span class="s s-Atom">def</span> <span class="nf">standardize_citekey</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">,</span> <span class="s s-Atom">warn_if_changed</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Standardize citation keys based on their source</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">standard_citekey</span> <span class="o">=</span> <span class="nv">CiteKey</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">).</span><span class="s s-Atom">standard_id</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">warn_if_changed</span> <span class="s s-Atom">and</span> <span class="s s-Atom">citekey</span> <span class="p">!</span><span class="o">=</span> <span class="s s-Atom">standard_citekey:</span>

        <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;standardize_citekey expected citekey to already be standardized.\n&quot;</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;Instead citekey was changed from {citekey!r} to {standard_citekey!r}&quot;</span>

        <span class="p">)</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">standard_citekey</span>

<span class="s s-Atom">def</span> <span class="nf">is_valid_citekey</span><span class="p">(</span>

    <span class="s s-Atom">citekey</span><span class="p">,</span> <span class="s s-Atom">allow_tag</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span> <span class="s s-Atom">allow_raw</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span> <span class="s s-Atom">allow_pandoc_xnos</span><span class="o">=</span><span class="nv">False</span>

<span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Return True if citekey is a properly formatted string. Return False if</span>

<span class="s2">    citekey is not a citation or is an invalid citation.</span>

<span class="s2">    In the case citekey is invalid, an error is logged. This</span>

<span class="s2">    function does not catch all invalid citekeys, but instead performs cursory</span>

<span class="s2">    checks, such as ensuring citekeys adhere to the expected formats. No calls to</span>

<span class="s2">    external resources are used by these checks, so they will not detect</span>

<span class="s2">    citekeys to non-existent identifiers unless those identifiers violate</span>

<span class="s2">    their source&#39;s syntax.</span>

<span class="s2">    allow_tag=False, allow_raw=False, and allow_pandoc_xnos=False enable</span>

<span class="s2">    allowing citekey sources that are valid for Manubot manuscripts, but</span>

<span class="s2">    likely not elsewhere. allow_tag=True enables citekey tags (e.g.</span>

<span class="s2">    tag:citation-tag). allow_raw=True enables raw citekeys (e.g.</span>

<span class="s2">    raw:manual-reference). allow_pandoc_xnos=True still returns False for</span>

<span class="s2">    pandoc-xnos references (e.g. fig:figure-id), but does not log an error.</span>

<span class="s2">    With the default of False for these arguments, valid sources are restricted</span>

<span class="s2">    to those for which manubot can retrieve metadata based only on the</span>

<span class="s2">    standalone citekey.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">handlers</span> <span class="s s-Atom">import</span> <span class="s s-Atom">prefix_to_handler</span>

    <span class="nn">try</span><span class="p">:</span>

        <span class="s s-Atom">citekey_obj</span> <span class="o">=</span> <span class="nv">CiteKey</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">)</span>

    <span class="nf">except</span> <span class="p">(</span><span class="nv">ValueError</span><span class="p">,</span> <span class="nv">TypeError</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="nn">error</span><span class="p">:</span>

        <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s s-Atom">error</span><span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">False</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span> <span class="o">is</span> <span class="nv">None</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;citekey not splittable via a single colon: {citekey}. &quot;</span>

            <span class="s2">&quot;Citekeys must be in the format of `source:identifier`.&quot;</span>

        <span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">False</span>

    <span class="s s-Atom">if</span> <span class="o">not</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">prefix</span> <span class="s s-Atom">or</span> <span class="o">not</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="nn">accession</span><span class="p">:</span>

        <span class="s s-Atom">msg</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;invalid citekey: {citekey!r}\nblank source or identifier&quot;</span>

        <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s s-Atom">msg</span><span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">False</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">allow_pandoc_xnos:</span>

        <span class="s s-Atom">#</span> <span class="nv">Exempted</span> <span class="s s-Atom">non</span><span class="o">-</span><span class="s s-Atom">citation</span> <span class="s s-Atom">sources</span> <span class="s s-Atom">used</span> <span class="s s-Atom">for</span> <span class="s s-Atom">pandoc</span><span class="o">-</span><span class="s s-Atom">fignos</span><span class="p">,</span>

        <span class="s s-Atom">#</span> <span class="s s-Atom">pandoc</span><span class="o">-</span><span class="s s-Atom">tablenos</span><span class="p">,</span> <span class="s s-Atom">and</span> <span class="s s-Atom">pandoc</span><span class="o">-</span><span class="s s-Atom">eqnos</span>

        <span class="s s-Atom">is_pandoc_xnos_prefix</span> <span class="o">=</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="nf">is_pandoc_xnos_prefix</span><span class="p">(</span><span class="s s-Atom">log_case_warning</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">is_pandoc_xnos_prefix:</span>

            <span class="s s-Atom">return</span> <span class="nv">False</span>

    <span class="s s-Atom">#</span> <span class="nv">Check</span> <span class="s s-Atom">supported</span> <span class="s s-Atom">source</span> <span class="s s-Atom">type</span>

    <span class="s s-Atom">sources</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="s s-Atom">prefix_to_handler</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">allow_raw:</span>

        <span class="s s-Atom">sources</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">allow_tag:</span>

        <span class="s s-Atom">sources</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">prefix</span> <span class="o">not</span> <span class="s s-Atom">in</span> <span class="nn">sources</span><span class="p">:</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span> <span class="s s-Atom">in</span> <span class="nn">sources</span><span class="p">:</span>

            <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>

                <span class="s2">&quot;citekey sources should be all lowercase.\n&quot;</span>

                <span class="s s-Atom">f&#39;Should {citekey} use &quot;{citekey_obj.prefix_lower}&quot; rather than &quot;{citekey_obj.prefix}&quot;?&#39;</span>

            <span class="p">)</span>

        <span class="nn">else</span><span class="p">:</span>

            <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>

                <span class="s s-Atom">f</span><span class="s2">&quot;invalid citekey: {citekey!r}\n&quot;</span>

                <span class="s s-Atom">f</span><span class="s2">&quot;Source {citekey_obj.prefix!r} is not valid.\n&quot;</span>

                <span class="s s-Atom">f&#39;Valid citation sources are {{{&quot;, &quot;.join(sorted(sources))}}}&#39;</span>

            <span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">False</span>

    <span class="s s-Atom">inspection</span> <span class="o">=</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="nf">inspect</span><span class="p">()</span>

    <span class="s s-Atom">if</span> <span class="nn">inspection</span><span class="p">:</span>

        <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;invalid {citekey_obj.prefix_lower} citekey: {citekey}\n{inspection}&quot;</span>

        <span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="nv">False</span>

    <span class="s s-Atom">return</span> <span class="nv">True</span>

<span class="s s-Atom">def</span> <span class="nf">shorten_citekey</span><span class="p">(</span><span class="s s-Atom">standard_citekey</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Return a shortened citekey derived from the input citekey.</span>

<span class="s2">    The input citekey should be standardized prior to this function,</span>

<span class="s2">    since differences in the input citekey will result in different shortened citekeys.</span>

<span class="s2">    Short citekeys are generated by converting the input citekey to a 6 byte hash,</span>

<span class="s2">    and then converting this digest to a base62 ASCII str. Shortened</span>

<span class="s2">    citekeys consist of characters in the following ranges: 0-9, a-z and A-Z.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">import</span> <span class="s s-Atom">hashlib</span>

    <span class="s s-Atom">import</span> <span class="s s-Atom">base62</span>

    <span class="s s-Atom">assert</span> <span class="o">not</span> <span class="s s-Atom">standard_citekey</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>

    <span class="s s-Atom">as_bytes</span> <span class="o">=</span> <span class="s s-Atom">standard_citekey</span><span class="p">.</span><span class="nf">encode</span><span class="p">()</span>

    <span class="s s-Atom">blake_hash</span> <span class="o">=</span> <span class="s s-Atom">hashlib</span><span class="p">.</span><span class="nf">blake2b</span><span class="p">(</span><span class="s s-Atom">as_bytes</span><span class="p">,</span> <span class="s s-Atom">digest_size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="s s-Atom">digest</span> <span class="o">=</span> <span class="s s-Atom">blake_hash</span><span class="p">.</span><span class="nf">digest</span><span class="p">()</span>

    <span class="s s-Atom">short_citekey</span> <span class="o">=</span> <span class="s s-Atom">base62</span><span class="p">.</span><span class="nf">encodebytes</span><span class="p">(</span><span class="s s-Atom">digest</span><span class="p">)</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">short_citekey</span>

<span class="s s-Atom">def</span> <span class="nf">citekey_to_csl_item</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">,</span> <span class="s s-Atom">prune</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Generate a CSL Item (Python dictionary) for the input citekey.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">from</span> <span class="s s-Atom">manubot</span> <span class="s s-Atom">import</span> <span class="k">__</span><span class="s s-Atom">version__</span> <span class="s s-Atom">as</span> <span class="s s-Atom">manubot_version</span>

    <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">handlers</span> <span class="s s-Atom">import</span> <span class="s s-Atom">prefix_to_handler</span>

    <span class="s s-Atom">citekey</span> <span class="o">==</span> <span class="nf">standardize_citekey</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">,</span> <span class="s s-Atom">warn_if_changed</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

    <span class="s s-Atom">citekey_obj</span> <span class="o">=</span> <span class="nv">CiteKey</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">)</span>

    <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">csl_item</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">prefix_lower</span> <span class="o">not</span> <span class="s s-Atom">in</span> <span class="s s-Atom">prefix_to_handler:</span>

        <span class="s s-Atom">msg</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;Unsupported citation source {citekey_obj.prefix_lower!r} in {citekey!r}&quot;</span>

        <span class="s s-Atom">raise</span> <span class="nv">ValueError</span><span class="p">(</span><span class="s s-Atom">msg</span><span class="p">)</span>

    <span class="s s-Atom">csl_item</span> <span class="o">=</span> <span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">csl_item</span>

    <span class="s s-Atom">note_text</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;This CSL JSON Item was automatically generated by Manubot v{manubot_version} using citation-by-identifier.&quot;</span>

    <span class="s s-Atom">note_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;standard_id&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">citekey</span><span class="p">}</span>

    <span class="s s-Atom">csl_item</span><span class="p">.</span><span class="nf">note_append_text</span><span class="p">(</span><span class="s s-Atom">note_text</span><span class="p">)</span>

    <span class="s s-Atom">csl_item</span><span class="p">.</span><span class="nf">note_append_dict</span><span class="p">(</span><span class="s s-Atom">note_dict</span><span class="p">)</span>

    <span class="s s-Atom">csl_item</span><span class="p">.</span><span class="nf">set_id</span><span class="p">(</span><span class="s s-Atom">citekey_obj</span><span class="p">.</span><span class="s s-Atom">short_id</span><span class="p">)</span>

    <span class="s s-Atom">csl_item</span><span class="p">.</span><span class="nf">clean</span><span class="p">(</span><span class="s s-Atom">prune</span><span class="o">=</span><span class="s s-Atom">prune</span><span class="p">)</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">csl_item</span>

<span class="s s-Atom">def</span> <span class="nf">infer_citekey_prefix</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Passthrough citekey if it has a valid citation key prefix. Otherwise,</span>

<span class="s2">    if the lowercase citekey prefix is valid, convert the prefix to lowercase.</span>

<span class="s2">    Otherwise, assume citekey is raw and prepend &quot;</span><span class="nn">raw</span><span class="p">:</span><span class="s2">&quot;.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">from</span> <span class="p">.</span><span class="s s-Atom">handlers</span> <span class="s s-Atom">import</span> <span class="s s-Atom">prefix_to_handler</span>

    <span class="s s-Atom">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">f</span><span class="s2">&quot;{x}:&quot;</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="nf">list</span><span class="p">(</span><span class="s s-Atom">prefix_to_handler</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]]</span>

    <span class="s s-Atom">for</span> <span class="s s-Atom">prefix</span> <span class="s s-Atom">in</span> <span class="nn">prefixes</span><span class="p">:</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">citekey</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="s s-Atom">prefix</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">return</span> <span class="s s-Atom">citekey</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">citekey</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">startswith</span><span class="p">(</span><span class="s s-Atom">prefix</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">return</span> <span class="s s-Atom">prefix</span> <span class="o">+</span> <span class="s s-Atom">citekey</span><span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="s s-Atom">prefix</span><span class="p">)</span> <span class="s s-Atom">:</span><span class="p">]</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">f</span><span class="s2">&quot;raw:{citekey}&quot;</span>

<span class="s s-Atom">def</span> <span class="nf">url_to_citekey</span><span class="p">(</span><span class="s s-Atom">url</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Convert a HTTP(s) URL into a citekey.</span>

<span class="s2">    For supported sources, convert from url citekey to an alternative source like doi.</span>

<span class="s2">    If citekeys fail inspection, revert alternative sources to URLs.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">from</span> <span class="s s-Atom">urllib</span><span class="p">.</span><span class="s s-Atom">parse</span> <span class="s s-Atom">import</span> <span class="s s-Atom">urlparse</span><span class="p">,</span> <span class="s s-Atom">unquote</span>

    <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="nv">None</span>

    <span class="s s-Atom">parsed_url</span> <span class="o">=</span> <span class="nf">urlparse</span><span class="p">(</span><span class="s s-Atom">url</span><span class="p">)</span>

    <span class="s s-Atom">domain_levels</span> <span class="o">=</span> <span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">hostname</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">domain_levels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="s s-Atom">:</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">]</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="nv">DOI</span> <span class="nv">URLs</span>

        <span class="s s-Atom">doi</span> <span class="o">=</span> <span class="nf">unquote</span><span class="p">(</span><span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>

        <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;doi:{doi}&quot;</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">domain_levels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sci-hub&quot;</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="nv">Sci</span><span class="o">-</span><span class="nv">Hub</span> <span class="s s-Atom">domains</span>

        <span class="s s-Atom">doi</span> <span class="o">=</span> <span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;doi:{doi}&quot;</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">domain_levels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="s s-Atom">:</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;biorxiv&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">]</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="s s-Atom">bioRxiv</span> <span class="nv">URL</span> <span class="s s-Atom">to</span> <span class="nv">DOI</span><span class="p">.</span> <span class="nv">See</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="s s-Atom">git</span><span class="p">.</span><span class="s s-Atom">io</span><span class="o">/</span><span class="nv">Je9Hq</span>

        <span class="s s-Atom">match</span> <span class="o">=</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>

            <span class="s s-Atom">r</span><span class="err">&quot;</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">?</span><span class="nv">P</span><span class="o">&lt;</span><span class="s s-Atom">biorxiv_id&gt;</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">4</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">)</span><span class="s s-Atom">?</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">6</span><span class="p">,})</span><span class="s2">&quot;,</span>

<span class="s2">            parsed_url.path,</span>

<span class="s2">        )</span>

<span class="s2">        if match:</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">doi</span><span class="p">:</span><span class="mf">10.1101</span><span class="s s-Atom">/</span><span class="p">{</span><span class="s s-Atom">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="s s-Atom">&#39;biorxiv_id&#39;</span><span class="p">)}</span><span class="s2">&quot;</span>

<span class="s2">    is_ncbi_url = parsed_url.hostname.endswith(&quot;</span><span class="s s-Atom">ncbi</span><span class="p">.</span><span class="s s-Atom">nlm</span><span class="p">.</span><span class="s s-Atom">nih</span><span class="p">.</span><span class="s s-Atom">gov</span><span class="s2">&quot;)</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pubmed/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmid</span><span class="p">:{</span><span class="s s-Atom">pmid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pmc/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed Central URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmcid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[3]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmcid</span><span class="p">:{</span><span class="s s-Atom">pmcid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if domain_levels[-2:] == [&quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;, &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;] and parsed_url.path.startswith(</span>

<span class="s2">        &quot;</span><span class="o">/</span><span class="s s-Atom">wiki/</span><span class="s2">&quot;</span>

<span class="s2">    ):</span>

<span class="s2">        # Wikidata URLs</span>

<span class="s2">        try:</span>

<span class="s2">            wikidata_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">wikidata</span><span class="p">:{</span><span class="s s-Atom">wikidata_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if domain_levels[-2:] == [&quot;</span><span class="s s-Atom">arxiv</span><span class="s2">&quot;, &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;]:</span>

<span class="s2">        # arXiv identifiers. See https://arxiv.org/help/arxiv_identifier</span>

<span class="s2">        try:</span>

<span class="s2">            arxiv_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;, maxsplit=2)[2]</span>

<span class="s2">            if arxiv_id.endswith(&quot;</span><span class="p">.</span><span class="s s-Atom">pdf</span><span class="s2">&quot;):</span>

<span class="s2">                arxiv_id = arxiv_id[:-4]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">arxiv</span><span class="p">:{</span><span class="s s-Atom">arxiv_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if citekey is None or CiteKey(citekey).inspect() is not None:</span>

<span class="s2">        citekey = f&quot;</span><span class="nn">url</span><span class="p">:{</span><span class="s s-Atom">url</span><span class="p">}</span><span class="err">&quot;</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">citekey</span>
</code></pre></div>


</details>
<h2 id="functions">Functions</h2>
<h3 id="citekey_to_csl_item">citekey_to_csl_item</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">citekey_to_csl_item</span><span class="p">(</span>
    <span class="n">citekey</span><span class="p">,</span>
    <span class="n">prune</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>


<p>Generate a CSL Item (Python dictionary) for the input citekey.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">citekey_to_csl_item</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Generate a CSL Item (Python dictionary) for the input citekey.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">manubot</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">manubot_version</span>

    <span class="kn">from</span> <span class="nn">.handlers</span> <span class="kn">import</span> <span class="n">prefix_to_handler</span>

    <span class="n">citekey</span> <span class="o">==</span> <span class="n">standardize_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span> <span class="n">warn_if_changed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">citekey_obj</span> <span class="o">=</span> <span class="n">CiteKey</span><span class="p">(</span><span class="n">citekey</span><span class="p">)</span>

    <span class="n">citekey_obj</span><span class="o">.</span><span class="n">csl_item</span>

    <span class="k">if</span> <span class="n">citekey_obj</span><span class="o">.</span><span class="n">prefix_lower</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prefix_to_handler</span><span class="p">:</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Unsupported citation source {citekey_obj.prefix_lower!r} in {citekey!r}&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">csl_item</span> <span class="o">=</span> <span class="n">citekey_obj</span><span class="o">.</span><span class="n">csl_item</span>

    <span class="n">note_text</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;This CSL JSON Item was automatically generated by Manubot v{manubot_version} using citation-by-identifier.&quot;</span>

    <span class="n">note_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;standard_id&quot;</span><span class="p">:</span> <span class="n">citekey</span><span class="p">}</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">note_append_text</span><span class="p">(</span><span class="n">note_text</span><span class="p">)</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">note_append_dict</span><span class="p">(</span><span class="n">note_dict</span><span class="p">)</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="n">citekey_obj</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="n">prune</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">csl_item</span>
</code></pre></div>


</details>
<h3 id="infer_citekey_prefix">infer_citekey_prefix</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">infer_citekey_prefix</span><span class="p">(</span>
    <span class="n">citekey</span>
<span class="p">)</span>
</code></pre></div>


<p>Passthrough citekey if it has a valid citation key prefix. Otherwise,
if the lowercase citekey prefix is valid, convert the prefix to lowercase.
Otherwise, assume citekey is raw and prepend "raw:".</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">infer_citekey_prefix</span><span class="p">(</span><span class="n">citekey</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Passthrough citekey if it has a valid citation key prefix. Otherwise,</span>

<span class="sd">    if the lowercase citekey prefix is valid, convert the prefix to lowercase.</span>

<span class="sd">    Otherwise, assume citekey is raw and prepend &quot;raw:&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">.handlers</span> <span class="kn">import</span> <span class="n">prefix_to_handler</span>

    <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;{x}:&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">prefix_to_handler</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">citekey</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">citekey</span>

        <span class="k">if</span> <span class="n">citekey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">citekey</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;raw:{citekey}&quot;</span>
</code></pre></div>


</details>
<h3 id="is_valid_citekey">is_valid_citekey</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">is_valid_citekey</span><span class="p">(</span>
    <span class="n">citekey</span><span class="p">,</span>
    <span class="n">allow_tag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_pandoc_xnos</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>


<p>Return True if citekey is a properly formatted string. Return False if
citekey is not a citation or is an invalid citation.</p>
<p>In the case citekey is invalid, an error is logged. This
function does not catch all invalid citekeys, but instead performs cursory
checks, such as ensuring citekeys adhere to the expected formats. No calls to
external resources are used by these checks, so they will not detect
citekeys to non-existent identifiers unless those identifiers violate
their source's syntax.</p>
<p>allow_tag=False, allow_raw=False, and allow_pandoc_xnos=False enable
allowing citekey sources that are valid for Manubot manuscripts, but
likely not elsewhere. allow_tag=True enables citekey tags (e.g.
tag:citation-tag). allow_raw=True enables raw citekeys (e.g.
raw:manual-reference). allow_pandoc_xnos=True still returns False for
pandoc-xnos references (e.g. fig:figure-id), but does not log an error.
With the default of False for these arguments, valid sources are restricted
to those for which manubot can retrieve metadata based only on the
standalone citekey.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="x">def is_valid_citekey(</span>

<span class="x">    citekey, allow_tag=False, allow_raw=False, allow_pandoc_xnos=False</span>

<span class="x">):</span>

<span class="x">    &quot;&quot;&quot;</span>

<span class="x">    Return True if citekey is a properly formatted string. Return False if</span>

<span class="x">    citekey is not a citation or is an invalid citation.</span>

<span class="x">    In the case citekey is invalid, an error is logged. This</span>

<span class="x">    function does not catch all invalid citekeys, but instead performs cursory</span>

<span class="x">    checks, such as ensuring citekeys adhere to the expected formats. No calls to</span>

<span class="x">    external resources are used by these checks, so they will not detect</span>

<span class="x">    citekeys to non-existent identifiers unless those identifiers violate</span>

<span class="x">    their source&#39;s syntax.</span>

<span class="x">    allow_tag=False, allow_raw=False, and allow_pandoc_xnos=False enable</span>

<span class="x">    allowing citekey sources that are valid for Manubot manuscripts, but</span>

<span class="x">    likely not elsewhere. allow_tag=True enables citekey tags (e.g.</span>

<span class="x">    tag:citation-tag). allow_raw=True enables raw citekeys (e.g.</span>

<span class="x">    raw:manual-reference). allow_pandoc_xnos=True still returns False for</span>

<span class="x">    pandoc-xnos references (e.g. fig:figure-id), but does not log an error.</span>

<span class="x">    With the default of False for these arguments, valid sources are restricted</span>

<span class="x">    to those for which manubot can retrieve metadata based only on the</span>

<span class="x">    standalone citekey.</span>

<span class="x">    &quot;&quot;&quot;</span>

<span class="x">    from .handlers import prefix_to_handler</span>

<span class="x">    try:</span>

<span class="x">        citekey_obj = CiteKey(citekey)</span>

<span class="x">    except (ValueError, TypeError) as error:</span>

<span class="x">        logging.error(error)</span>

<span class="x">        return False</span>

<span class="x">    if citekey_obj.prefix_lower is None:</span>

<span class="x">        logging.error(</span>

<span class="x">            f&quot;citekey not splittable via a single colon: {citekey}. &quot;</span>

<span class="x">            &quot;Citekeys must be in the format of `source:identifier`.&quot;</span>

<span class="x">        )</span>

<span class="x">        return False</span>

<span class="x">    if not citekey_obj.prefix or not citekey_obj.accession:</span>

<span class="x">        msg = f&quot;invalid citekey: {citekey!r}\nblank source or identifier&quot;</span>

<span class="x">        logging.error(msg)</span>

<span class="x">        return False</span>

<span class="x">    if allow_pandoc_xnos:</span>

<span class="x">        # Exempted non-citation sources used for pandoc-fignos,</span>

<span class="x">        # pandoc-tablenos, and pandoc-eqnos</span>

<span class="x">        is_pandoc_xnos_prefix = citekey_obj.is_pandoc_xnos_prefix(log_case_warning=True)</span>

<span class="x">        if is_pandoc_xnos_prefix:</span>

<span class="x">            return False</span>

<span class="x">    # Check supported source type</span>

<span class="x">    sources = set(prefix_to_handler)</span>

<span class="x">    if allow_raw:</span>

<span class="x">        sources.add(&quot;raw&quot;)</span>

<span class="x">    if allow_tag:</span>

<span class="x">        sources.add(&quot;tag&quot;)</span>

<span class="x">    if citekey_obj.prefix not in sources:</span>

<span class="x">        if citekey_obj.prefix_lower in sources:</span>

<span class="x">            logging.error(</span>

<span class="x">                &quot;citekey sources should be all lowercase.\n&quot;</span>

<span class="x">                f&#39;Should {citekey} use &quot;{citekey_obj.prefix_lower}&quot; rather than &quot;{citekey_obj.prefix}&quot;?&#39;</span>

<span class="x">            )</span>

<span class="x">        else:</span>

<span class="x">            logging.error(</span>

<span class="x">                f&quot;invalid citekey: {citekey!r}\n&quot;</span>

<span class="x">                f&quot;Source {citekey_obj.prefix!r} is not valid.\n&quot;</span>

<span class="x">                f&#39;Valid citation sources are </span><span class="cp">{{</span><span class="o">{</span><span class="s2">&quot;, &quot;</span><span class="nv">.join</span><span class="o">(</span><span class="nv">sorted</span><span class="o">(</span><span class="nv">sources</span><span class="o">))</span><span class="cp">}}</span><span class="x">}&#39;</span>

<span class="x">            )</span>

<span class="x">        return False</span>

<span class="x">    inspection = citekey_obj.inspect()</span>

<span class="x">    if inspection:</span>

<span class="x">        logging.error(</span>

<span class="x">            f&quot;invalid {citekey_obj.prefix_lower} citekey: {citekey}\n{inspection}&quot;</span>

<span class="x">        )</span>

<span class="x">        return False</span>

<span class="x">    return True</span>
</code></pre></div>


</details>
<h3 id="shorten_citekey">shorten_citekey</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">shorten_citekey</span><span class="p">(</span>
    <span class="n">standard_citekey</span>
<span class="p">)</span>
</code></pre></div>


<p>Return a shortened citekey derived from the input citekey.
The input citekey should be standardized prior to this function,
since differences in the input citekey will result in different shortened citekeys.
Short citekeys are generated by converting the input citekey to a 6 byte hash,
and then converting this digest to a base62 ASCII str. Shortened
citekeys consist of characters in the following ranges: 0-9, a-z and A-Z.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">shorten_citekey</span><span class="p">(</span><span class="n">standard_citekey</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Return a shortened citekey derived from the input citekey.</span>

<span class="sd">    The input citekey should be standardized prior to this function,</span>

<span class="sd">    since differences in the input citekey will result in different shortened citekeys.</span>

<span class="sd">    Short citekeys are generated by converting the input citekey to a 6 byte hash,</span>

<span class="sd">    and then converting this digest to a base62 ASCII str. Shortened</span>

<span class="sd">    citekeys consist of characters in the following ranges: 0-9, a-z and A-Z.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">hashlib</span>

    <span class="kn">import</span> <span class="nn">base62</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">standard_citekey</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>

    <span class="n">as_bytes</span> <span class="o">=</span> <span class="n">standard_citekey</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="n">blake_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">blake2b</span><span class="p">(</span><span class="n">as_bytes</span><span class="p">,</span> <span class="n">digest_size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">digest</span> <span class="o">=</span> <span class="n">blake_hash</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

    <span class="n">short_citekey</span> <span class="o">=</span> <span class="n">base62</span><span class="o">.</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">short_citekey</span>
</code></pre></div>


</details>
<h3 id="standardize_citekey">standardize_citekey</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">standardize_citekey</span><span class="p">(</span>
    <span class="n">citekey</span><span class="p">,</span>
    <span class="n">warn_if_changed</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>


<p>Standardize citation keys based on their source</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="nv">@functools</span><span class="p">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">5</span><span class="n">_000</span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">standardize_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span><span class="w"> </span><span class="n">warn_if_changed</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">    Standardize citation keys based on their source</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">standard_citekey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CiteKey</span><span class="p">(</span><span class="n">citekey</span><span class="p">).</span><span class="n">standard_id</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">warn_if_changed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">citekey</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nl">standard_citekey</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;standardize_citekey expected citekey to already be standardized.\n&quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;Instead citekey was changed from {citekey!r} to {standard_citekey!r}&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">standard_citekey</span><span class="w"></span>
</code></pre></div>


</details>
<h3 id="url_to_citekey">url_to_citekey</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">url_to_citekey</span><span class="p">(</span>
    <span class="n">url</span>
<span class="p">)</span>
</code></pre></div>


<p>Convert a HTTP(s) URL into a citekey.
For supported sources, convert from url citekey to an alternative source like doi.
If citekeys fail inspection, revert alternative sources to URLs.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="s s-Atom">def</span> <span class="nf">url_to_citekey</span><span class="p">(</span><span class="s s-Atom">url</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Convert a HTTP(s) URL into a citekey.</span>

<span class="s2">    For supported sources, convert from url citekey to an alternative source like doi.</span>

<span class="s2">    If citekeys fail inspection, revert alternative sources to URLs.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">from</span> <span class="s s-Atom">urllib</span><span class="p">.</span><span class="s s-Atom">parse</span> <span class="s s-Atom">import</span> <span class="s s-Atom">urlparse</span><span class="p">,</span> <span class="s s-Atom">unquote</span>

    <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="nv">None</span>

    <span class="s s-Atom">parsed_url</span> <span class="o">=</span> <span class="nf">urlparse</span><span class="p">(</span><span class="s s-Atom">url</span><span class="p">)</span>

    <span class="s s-Atom">domain_levels</span> <span class="o">=</span> <span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">hostname</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">domain_levels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="s s-Atom">:</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">]</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="nv">DOI</span> <span class="nv">URLs</span>

        <span class="s s-Atom">doi</span> <span class="o">=</span> <span class="nf">unquote</span><span class="p">(</span><span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>

        <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;doi:{doi}&quot;</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">domain_levels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sci-hub&quot;</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="nv">Sci</span><span class="o">-</span><span class="nv">Hub</span> <span class="s s-Atom">domains</span>

        <span class="s s-Atom">doi</span> <span class="o">=</span> <span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;doi:{doi}&quot;</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">domain_levels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="s s-Atom">:</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;biorxiv&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">]</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="s s-Atom">bioRxiv</span> <span class="nv">URL</span> <span class="s s-Atom">to</span> <span class="nv">DOI</span><span class="p">.</span> <span class="nv">See</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="s s-Atom">git</span><span class="p">.</span><span class="s s-Atom">io</span><span class="o">/</span><span class="nv">Je9Hq</span>

        <span class="s s-Atom">match</span> <span class="o">=</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>

            <span class="s s-Atom">r</span><span class="err">&quot;</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">?</span><span class="nv">P</span><span class="o">&lt;</span><span class="s s-Atom">biorxiv_id&gt;</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">4</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">)</span><span class="s s-Atom">?</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">6</span><span class="p">,})</span><span class="s2">&quot;,</span>

<span class="s2">            parsed_url.path,</span>

<span class="s2">        )</span>

<span class="s2">        if match:</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">doi</span><span class="p">:</span><span class="mf">10.1101</span><span class="s s-Atom">/</span><span class="p">{</span><span class="s s-Atom">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="s s-Atom">&#39;biorxiv_id&#39;</span><span class="p">)}</span><span class="s2">&quot;</span>

<span class="s2">    is_ncbi_url = parsed_url.hostname.endswith(&quot;</span><span class="s s-Atom">ncbi</span><span class="p">.</span><span class="s s-Atom">nlm</span><span class="p">.</span><span class="s s-Atom">nih</span><span class="p">.</span><span class="s s-Atom">gov</span><span class="s2">&quot;)</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pubmed/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmid</span><span class="p">:{</span><span class="s s-Atom">pmid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pmc/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed Central URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmcid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[3]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmcid</span><span class="p">:{</span><span class="s s-Atom">pmcid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if domain_levels[-2:] == [&quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;, &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;] and parsed_url.path.startswith(</span>

<span class="s2">        &quot;</span><span class="o">/</span><span class="s s-Atom">wiki/</span><span class="s2">&quot;</span>

<span class="s2">    ):</span>

<span class="s2">        # Wikidata URLs</span>

<span class="s2">        try:</span>

<span class="s2">            wikidata_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">wikidata</span><span class="p">:{</span><span class="s s-Atom">wikidata_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if domain_levels[-2:] == [&quot;</span><span class="s s-Atom">arxiv</span><span class="s2">&quot;, &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;]:</span>

<span class="s2">        # arXiv identifiers. See https://arxiv.org/help/arxiv_identifier</span>

<span class="s2">        try:</span>

<span class="s2">            arxiv_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;, maxsplit=2)[2]</span>

<span class="s2">            if arxiv_id.endswith(&quot;</span><span class="p">.</span><span class="s s-Atom">pdf</span><span class="s2">&quot;):</span>

<span class="s2">                arxiv_id = arxiv_id[:-4]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">arxiv</span><span class="p">:{</span><span class="s s-Atom">arxiv_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if citekey is None or CiteKey(citekey).inspect() is not None:</span>

<span class="s2">        citekey = f&quot;</span><span class="nn">url</span><span class="p">:{</span><span class="s s-Atom">url</span><span class="p">}</span><span class="err">&quot;</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">citekey</span>
</code></pre></div>


</details>
<h2 id="classes">Classes</h2>
<h3 id="citekey">CiteKey</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CiteKey</span><span class="p">(</span>
    <span class="n">input_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>


<p>CiteKey(input_id: str, aliases: dict = <factory>)</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nl">CiteKey</span><span class="p">:</span>

    <span class="nl">input_id</span><span class="p">:</span> <span class="n">str</span>

    <span class="nl">aliases</span><span class="p">:</span> <span class="n">dict</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">dict</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__post_init__</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="nb">self</span><span class="p">.</span><span class="n">check_input_id</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">input_id</span><span class="p">)</span>

    <span class="p">@</span><span class="n">staticmethod</span>

    <span class="n">def</span> <span class="n">check_input_id</span><span class="p">(</span><span class="n">input_id</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">input_id</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span><span class="o">:</span>

            <span class="n">raise</span> <span class="n">TypeError</span><span class="p">(</span>

                <span class="s">&quot;input_id should be type &#39;str&#39; not &quot;</span>

                <span class="n">f</span><span class="s">&quot;{type(input_id).__name__!r}: {input_id!r}&quot;</span>

            <span class="p">)</span>

        <span class="k">if</span> <span class="n">input_id</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="n">f</span><span class="s">&quot;invalid citekey input_id: {input_id!r}</span><span class="se">\n</span><span class="s">starts with &#39;@&#39;&quot;</span>

    <span class="p">@</span><span class="n">classmethod</span>

    <span class="p">@</span><span class="n">functools</span><span class="p">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">None</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">from_input_id</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Cached constructor&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="p">@</span><span class="n">cached_property</span>

    <span class="n">def</span> <span class="n">dealiased_id</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">aliases</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">input_id</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">input_id</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">_set_prefix_accession</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="nl">try</span><span class="p">:</span>

            <span class="n">prefix</span><span class="p">,</span> <span class="n">accession</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">dealiased_id</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">except</span> <span class="nl">ValueError</span><span class="p">:</span>

            <span class="n">prefix</span><span class="p">,</span> <span class="n">accession</span> <span class="o">=</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span>

        <span class="nb">self</span><span class="p">.</span><span class="n">_prefix</span> <span class="o">=</span> <span class="n">prefix</span>

        <span class="nb">self</span><span class="p">.</span><span class="n">_accession</span> <span class="o">=</span> <span class="n">accession</span>

    <span class="k">@property</span>

    <span class="n">def</span> <span class="n">prefix</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">hasattr</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="s">&quot;_prefix&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_set_prefix_accession</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">_prefix</span>

    <span class="k">@property</span>

    <span class="n">def</span> <span class="n">prefix_lower</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">prefix</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">@property</span>

    <span class="n">def</span> <span class="n">accession</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">hasattr</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="s">&quot;_accession&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_set_prefix_accession</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">_accession</span>

    <span class="k">@property</span>

    <span class="n">def</span> <span class="n">standard_prefix</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">hasattr</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="s">&quot;_standard_prefix&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standardize</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">_standard_prefix</span>

    <span class="k">@property</span>

    <span class="n">def</span> <span class="n">standard_accession</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">hasattr</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="s">&quot;_standard_accession&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standardize</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">_standard_accession</span>

    <span class="p">@</span><span class="n">cached_property</span>

    <span class="n">def</span> <span class="n">handler</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="n">from</span> <span class="p">.</span><span class="n">handlers</span> <span class="n">import</span> <span class="n">Handler</span><span class="p">,</span> <span class="n">get_handler</span>

        <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="nl">is_handled_prefix</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">get_handler</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">prefix_lower</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Handler</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">prefix_lower</span><span class="p">)</span>

    <span class="p">@</span><span class="n">cached_property</span>

    <span class="n">def</span> <span class="n">is_handled_prefix</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="n">from</span> <span class="p">.</span><span class="n">handlers</span> <span class="n">import</span> <span class="n">prefix_to_handler</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">prefix_lower</span> <span class="k">in</span> <span class="n">prefix_to_handler</span>

    <span class="n">def</span> <span class="n">inspect</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">handler</span><span class="p">.</span><span class="n">inspect</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">_standardize</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="n">prefix_lower</span> <span class="n">is</span> <span class="nl">None</span><span class="p">:</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standard_prefix</span> <span class="o">=</span> <span class="n">None</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standard_accession</span> <span class="o">=</span> <span class="n">None</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standard_id</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">dealiased_id</span>

            <span class="k">return</span>

        <span class="p">(</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standard_prefix</span><span class="p">,</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standard_accession</span><span class="p">,</span>

        <span class="p">)</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">handler</span><span class="p">.</span><span class="n">standardize_prefix_accession</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">accession</span><span class="p">)</span>

        <span class="nb">self</span><span class="p">.</span><span class="n">_standard_id</span> <span class="o">=</span> <span class="n">f</span><span class="s">&quot;{self._standard_prefix}:{self._standard_accession}&quot;</span>

    <span class="k">@property</span>

    <span class="n">def</span> <span class="n">standard_id</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">hasattr</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="s">&quot;_standard_id&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">_standardize</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">_standard_id</span>

    <span class="p">@</span><span class="n">cached_property</span>

    <span class="n">def</span> <span class="n">short_id</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="n">shorten_citekey</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">standard_id</span><span class="p">)</span>

    <span class="p">@</span><span class="n">cached_property</span>

    <span class="n">def</span> <span class="n">all_ids</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">input_id</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">dealiased_id</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">standard_id</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">short_id</span><span class="p">]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">ids</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>  <span class="err">#</span> <span class="n">remove</span> <span class="n">None</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">dict</span><span class="p">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>  <span class="err">#</span> <span class="n">deduplicate</span>

        <span class="k">return</span> <span class="n">ids</span>

    <span class="n">def</span> <span class="n">__hash__</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="n">hash</span><span class="p">((</span><span class="nb">self</span><span class="p">.</span><span class="n">input_id</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">dealiased_id</span><span class="p">))</span>

    <span class="n">def</span> <span class="n">__repr__</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="s">&quot; --&gt; &quot;</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>

            <span class="n">f</span><span class="s">&quot;{getattr(self, key)} ({key})&quot;</span>

            <span class="k">for</span> <span class="n">key</span> <span class="k">in</span> <span class="p">(</span>

                <span class="s">&quot;input_id&quot;</span><span class="p">,</span>

                <span class="s">&quot;dealiased_id&quot;</span><span class="p">,</span>

                <span class="s">&quot;prefix_lower&quot;</span><span class="p">,</span>

                <span class="s">&quot;accession&quot;</span><span class="p">,</span>

                <span class="s">&quot;standard_id&quot;</span><span class="p">,</span>

                <span class="s">&quot;short_id&quot;</span><span class="p">,</span>

            <span class="p">)</span>

        <span class="p">)</span>

    <span class="p">@</span><span class="n">cached_property</span>

    <span class="n">def</span> <span class="n">csl_item</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">:</span>

        <span class="n">from</span> <span class="p">.</span><span class="n">csl_item</span> <span class="n">import</span> <span class="n">CSL_Item</span>

        <span class="n">csl_item</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">handler</span><span class="p">.</span><span class="n">get_csl_item</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">csl_item</span><span class="p">,</span> <span class="n">CSL_Item</span><span class="p">)</span><span class="o">:</span>

            <span class="n">csl_item</span> <span class="o">=</span> <span class="n">CSL_Item</span><span class="p">(</span><span class="n">csl_item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">csl_item</span>

    <span class="n">def</span> <span class="n">is_pandoc_xnos_prefix</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">log_case_warning</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="o">:</span>

        <span class="n">from</span> <span class="p">.</span><span class="n">handlers</span> <span class="n">import</span> <span class="n">_pandoc_xnos_prefixes</span>

        <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="n">prefix</span> <span class="k">in</span> <span class="nl">_pandoc_xnos_prefixes</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">True</span>

        <span class="k">if</span> <span class="n">log_case_warning</span> <span class="n">and</span> <span class="nb">self</span><span class="p">.</span><span class="n">prefix_lower</span> <span class="k">in</span> <span class="nl">_pandoc_xnos_prefixes</span><span class="p">:</span>

            <span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span>

                <span class="s">&quot;pandoc-xnos prefixes should be all lowercase.</span><span class="se">\n</span><span class="s">&quot;</span>

                <span class="n">f</span><span class="err">&#39;</span><span class="n">Should</span> <span class="p">{</span><span class="nb">self</span><span class="p">.</span><span class="n">input_id</span><span class="o">!</span><span class="n">r</span><span class="p">}</span> <span class="n">use</span> <span class="p">{</span><span class="nb">self</span><span class="p">.</span><span class="n">prefix_lower</span><span class="o">!</span><span class="n">r</span><span class="p">}</span> <span class="n">rather</span> <span class="n">than</span> <span class="s">&quot;{self.prefix!r}&quot;</span><span class="o">?</span><span class="err">&#39;</span>

            <span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>
</code></pre></div>


</details>
<hr />
<h4 id="static-methods">Static methods</h4>
<h5 id="check_input_id">check_input_id</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">check_input_id</span><span class="p">(</span>
    <span class="n">input_id</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="p">@</span><span class="n">staticmethod</span>

    <span class="n">def</span> <span class="n">check_input_id</span><span class="p">(</span><span class="n">input_id</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">input_id</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span><span class="o">:</span>

            <span class="n">raise</span> <span class="n">TypeError</span><span class="p">(</span>

                <span class="s">&quot;input_id should be type &#39;str&#39; not &quot;</span>

                <span class="n">f</span><span class="s">&quot;{type(input_id).__name__!r}: {input_id!r}&quot;</span>

            <span class="p">)</span>

        <span class="k">if</span> <span class="n">input_id</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span><span class="o">:</span>

            <span class="n">f</span><span class="s">&quot;invalid citekey input_id: {input_id!r}</span><span class="se">\n</span><span class="s">starts with &#39;@&#39;&quot;</span>
</code></pre></div>


</details>
<h5 id="from_input_id">from_input_id</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_input_id</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Cached constructor</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@classmethod</span><span class="w"></span>

<span class="w">    </span><span class="nv">@functools</span><span class="p">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_input_id</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Cached constructor&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


</details>
<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">accession</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">prefix</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">prefix_lower</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">standard_accession</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">standard_id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">standard_prefix</span>
</code></pre></div>


<h4 id="methods">Methods</h4>
<h5 id="all_ids">all_ids</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">all_ids</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>


<h5 id="csl_item">csl_item</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">csl_item</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>


<h5 id="dealiased_id">dealiased_id</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">dealiased_id</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>


<h5 id="handler">handler</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>


<h5 id="inspect">inspect</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">inspect</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="k">self</span><span class="p">.</span><span class="k">handler</span><span class="p">.</span><span class="n">inspect</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="is_handled_prefix">is_handled_prefix</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">is_handled_prefix</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>


<h5 id="is_pandoc_xnos_prefix">is_pandoc_xnos_prefix</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">is_pandoc_xnos_prefix</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">log_case_warning</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="k">def</span> <span class="nf">is_pandoc_xnos_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_case_warning</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">.handlers</span> <span class="kn">import</span> <span class="n">_pandoc_xnos_prefixes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="ow">in</span> <span class="n">_pandoc_xnos_prefixes</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">log_case_warning</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_lower</span> <span class="ow">in</span> <span class="n">_pandoc_xnos_prefixes</span><span class="p">:</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>

                <span class="s2">&quot;pandoc-xnos prefixes should be all lowercase.</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="n">f</span><span class="s1">&#39;Should {self.input_id!r} use {self.prefix_lower!r} rather than &quot;{self.prefix!r}&quot;?&#39;</span>

            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div>


</details>
<h5 id="short_id">short_id</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">short_id</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cite_command/" title="Cite Command" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cite Command
              </span>
            </div>
          </a>
        
        
          <a href="../citeproc/" title="Citeproc" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Citeproc
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../../../.."}})</script>
      
    
  </body>
</html>