



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Citekey - manubot</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#module-manubotcitecitekey" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="manubot" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              manubot
            </span>
            <span class="md-header-nav__topic">
              
                Citekey
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/manubot/manubot/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    manubot
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="manubot" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    manubot
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/manubot/manubot/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    manubot
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../LICENSE/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      Manubot
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Manubot
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../command/" title="Command" class="md-nav__link">
      Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../util/" title="Util" class="md-nav__link">
      Util
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-4" type="checkbox" id="nav-3-1-4" checked>
    
    <label class="md-nav__link" for="nav-3-1-4">
      Cite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-4">
        Cite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../arxiv/" title="Arxiv" class="md-nav__link">
      Arxiv
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cite_command/" title="Cite Command" class="md-nav__link">
      Cite Command
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Citekey
      </label>
    
    <a href="./" title="Citekey" class="md-nav__link md-nav__link--active">
      Citekey
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citekey_to_csl_item" class="md-nav__link">
    citekey_to_csl_item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_citekey_prefix" class="md-nav__link">
    infer_citekey_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect_citekey" class="md-nav__link">
    inspect_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_citekey" class="md-nav__link">
    is_valid_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shorten_citekey" class="md-nav__link">
    shorten_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standardize_citekey" class="md-nav__link">
    standardize_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_to_citekey" class="md-nav__link">
    url_to_citekey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../citeproc/" title="Citeproc" class="md-nav__link">
      Citeproc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../csl_item/" title="Csl Item" class="md-nav__link">
      Csl Item
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../doi/" title="Doi" class="md-nav__link">
      Doi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../isbn/" title="Isbn" class="md-nav__link">
      Isbn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pubmed/" title="Pubmed" class="md-nav__link">
      Pubmed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../url/" title="Url" class="md-nav__link">
      Url
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wikidata/" title="Wikidata" class="md-nav__link">
      Wikidata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zotero/" title="Zotero" class="md-nav__link">
      Zotero
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-4-13" type="checkbox" id="nav-3-1-4-13">
    
    <label class="md-nav__link" for="nav-3-1-4-13">
      Tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-3-1-4-13">
        Tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_arxiv/" title="Test Arxiv" class="md-nav__link">
      Test Arxiv
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_cite_command/" title="Test Cite Command" class="md-nav__link">
      Test Cite Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_citekey/" title="Test Citekey" class="md-nav__link">
      Test Citekey
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_citekey_api/" title="Test Citekey Api" class="md-nav__link">
      Test Citekey Api
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_citeproc/" title="Test Citeproc" class="md-nav__link">
      Test Citeproc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_csl_item/" title="Test Csl Item" class="md-nav__link">
      Test Csl Item
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_doi/" title="Test Doi" class="md-nav__link">
      Test Doi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_isbn/" title="Test Isbn" class="md-nav__link">
      Test Isbn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_pubmed/" title="Test Pubmed" class="md-nav__link">
      Test Pubmed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_url/" title="Test Url" class="md-nav__link">
      Test Url
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_wikidata/" title="Test Wikidata" class="md-nav__link">
      Test Wikidata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/test_zotero/" title="Test Zotero" class="md-nav__link">
      Test Zotero
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-5" type="checkbox" id="nav-3-1-5">
    
    <label class="md-nav__link" for="nav-3-1-5">
      Pandoc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-5">
        Pandoc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/bibliography/" title="Bibliography" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandoc/util/" title="Util" class="md-nav__link">
      Util
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-6" type="checkbox" id="nav-3-1-6">
    
    <label class="md-nav__link" for="nav-3-1-6">
      Process
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-6">
        Process
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/bibliography/" title="Bibliography" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/ci/" title="Ci" class="md-nav__link">
      Ci
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/manuscript/" title="Manuscript" class="md-nav__link">
      Manuscript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/metadata/" title="Metadata" class="md-nav__link">
      Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/process_command/" title="Process Command" class="md-nav__link">
      Process Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/util/" title="Util" class="md-nav__link">
      Util
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-6-8" type="checkbox" id="nav-3-1-6-8">
    
    <label class="md-nav__link" for="nav-3-1-6-8">
      Tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-3-1-6-8">
        Tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_bibliography/" title="Test Bibliography" class="md-nav__link">
      Test Bibliography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_ci/" title="Test Ci" class="md-nav__link">
      Test Ci
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_manuscript/" title="Test Manuscript" class="md-nav__link">
      Test Manuscript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_metadata/" title="Test Metadata" class="md-nav__link">
      Test Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_process_command/" title="Test Process Command" class="md-nav__link">
      Test Process Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../process/tests/test_util/" title="Test Util" class="md-nav__link">
      Test Util
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-7" type="checkbox" id="nav-3-1-7">
    
    <label class="md-nav__link" for="nav-3-1-7">
      Tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-7">
        Tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_command/" title="Test Command" class="md-nav__link">
      Test Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_imports/" title="Test Imports" class="md-nav__link">
      Test Imports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_readme/" title="Test Readme" class="md-nav__link">
      Test Readme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/test_util/" title="Test Util" class="md-nav__link">
      Test Util
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-8" type="checkbox" id="nav-3-1-8">
    
    <label class="md-nav__link" for="nav-3-1-8">
      Webpage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-8">
        Webpage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../webpage/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webpage/webpage_command/" title="Webpage Command" class="md-nav__link">
      Webpage Command
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citekey_to_csl_item" class="md-nav__link">
    citekey_to_csl_item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_citekey_prefix" class="md-nav__link">
    infer_citekey_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect_citekey" class="md-nav__link">
    inspect_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_citekey" class="md-nav__link">
    is_valid_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shorten_citekey" class="md-nav__link">
    shorten_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standardize_citekey" class="md-nav__link">
    standardize_citekey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_to_citekey" class="md-nav__link">
    url_to_citekey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/manubot/manubot/edit/master/reference/manubot/cite/citekey.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="module-manubotcitecitekey">Module manubot.cite.citekey</h1>
<p>Functions importable from manubot.cite submodule (submodule API):</p>
<p>standardize_citekey()
  citekey_to_csl_item()</p>
<p>Helpers:</p>
<p>inspect_citekey()
  is_valid_citekey() - also used in manubot.process
  shorten_citekey() - used solely in manubot.process
  infer_citekey_prefix()</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="s2">&quot;&quot;&quot;Functions importable from manubot.cite submodule (submodule API):</span>

<span class="s2">  standardize_citekey()</span>

<span class="s2">  citekey_to_csl_item()</span>

<span class="s2">Helpers:</span>

<span class="s2">  inspect_citekey()</span>

<span class="s2">  is_valid_citekey() - also used in manubot.process</span>

<span class="s2">  shorten_citekey() - used solely in manubot.process</span>

<span class="s2">  infer_citekey_prefix()</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">functools</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">logging</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">re</span>

<span class="s s-Atom">from</span> <span class="s s-Atom">manubot</span><span class="p">.</span><span class="s s-Atom">util</span> <span class="s s-Atom">import</span> <span class="s s-Atom">import_function</span>

<span class="s s-Atom">citeproc_retrievers</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">&quot;doi&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.doi.get_doi_csl_item&quot;</span><span class="p">,</span>

    <span class="s2">&quot;pmid&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.pubmed.get_pubmed_csl_item&quot;</span><span class="p">,</span>

    <span class="s2">&quot;pmcid&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.pubmed.get_pmc_csl_item&quot;</span><span class="p">,</span>

    <span class="s2">&quot;arxiv&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.arxiv.get_arxiv_csl_item&quot;</span><span class="p">,</span>

    <span class="s2">&quot;isbn&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.isbn.get_isbn_csl_item&quot;</span><span class="p">,</span>

    <span class="s2">&quot;wikidata&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.wikidata.get_wikidata_csl_item&quot;</span><span class="p">,</span>

    <span class="s2">&quot;url&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;manubot.cite.url.get_url_csl_item&quot;</span><span class="p">,</span>

<span class="p">}</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="s2">Regex to extract citation keys.</span>

<span class="s2">The leading &#39;@&#39; is omitted from the single match group.</span>

<span class="s2">Same rules as pandoc, except more permissive in the following ways:</span>

<span class="s2">1. the final character can be a slash because many URLs end in a slash.</span>

<span class="s2">2. underscores are allowed in internal characters because URLs, DOIs, and</span>

<span class="s2">   citation tags often contain underscores.</span>

<span class="s2">If a citekey does not match this regex, it can be substituted for a</span>

<span class="s2">tag that does, as defined in citation-tags.tsv.</span>

<span class="s2">https://github.com/greenelab/manubot-rootstock/issues/2#issuecomment-312153192</span>

<span class="s2">Prototyped at https://regex101.com/r/s3Asz3/4</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="s s-Atom">citekey_pattern</span> <span class="o">=</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="s s-Atom">r</span><span class="err">&quot;</span><span class="p">(</span><span class="s s-Atom">?&lt;</span><span class="p">!</span><span class="s s-Atom">\w</span><span class="p">)</span><span class="s s-Atom">@</span><span class="p">([</span><span class="s s-Atom">a</span><span class="o">-</span><span class="s s-Atom">zA</span><span class="o">-</span><span class="nv">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="s s-Atom">\</span><span class="nn">w</span><span class="p">:.</span><span class="s s-Atom">#</span><span class="err">$</span><span class="c1">%&amp;\-+?&lt;&gt;~/]*[a-zA-Z0-9/])&quot;)</span>

<span class="s s-Atom">@functools</span><span class="p">.</span><span class="nf">lru_cache</span><span class="p">(</span><span class="s s-Atom">maxsize</span><span class="o">=</span><span class="mi">5</span><span class="k">_</span><span class="mi">000</span><span class="p">)</span>

<span class="s s-Atom">def</span> <span class="nf">standardize_citekey</span><span class="p">(</span><span class="s s-Atom">citekey</span><span class="p">,</span> <span class="s s-Atom">warn_if_changed</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Standardize citation keys based on their source</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">source</span><span class="p">,</span> <span class="s s-Atom">identifier</span> <span class="o">=</span> <span class="s s-Atom">citekey</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">source</span> <span class="o">==</span> <span class="s2">&quot;doi&quot;</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">identifier</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="s2">&quot;10/&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">from</span> <span class="s s-Atom">manubot</span><span class="p">.</span><span class="s s-Atom">cite</span><span class="p">.</span><span class="s s-Atom">doi</span> <span class="s s-Atom">import</span> <span class="s s-Atom">expand_short_doi</span>

            <span class="nn">try</span><span class="p">:</span>

                <span class="s s-Atom">identifier</span> <span class="o">=</span> <span class="nf">expand_short_doi</span><span class="p">(</span><span class="s s-Atom">identifier</span><span class="p">)</span>

            <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">error</span><span class="p">:</span>

                <span class="s s-Atom">#</span> <span class="nv">If</span> <span class="nv">DOI</span> <span class="s s-Atom">shortening</span> <span class="s s-Atom">fails</span><span class="p">,</span> <span class="s s-Atom">return</span> <span class="s s-Atom">the</span> <span class="s s-Atom">unshortened</span> <span class="nv">DOI</span><span class="p">.</span>

                <span class="s s-Atom">#</span> <span class="nv">DOI</span> <span class="s s-Atom">metadata</span> <span class="s s-Atom">lookup</span> <span class="s s-Atom">will</span> <span class="s s-Atom">eventually</span> <span class="s s-Atom">fail</span> <span class="s s-Atom">somewhere</span> <span class="s s-Atom">with</span>

                <span class="s s-Atom">#</span> <span class="s s-Atom">appropriate</span> <span class="s s-Atom">error</span> <span class="s s-Atom">handling</span><span class="p">,</span> <span class="s s-Atom">as</span> <span class="s s-Atom">opposed</span> <span class="s s-Atom">to</span> <span class="s s-Atom">here</span><span class="p">.</span>

                <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>

                    <span class="s s-Atom">f</span><span class="s2">&quot;Error in expand_short_doi for {identifier} &quot;</span>

                    <span class="s s-Atom">f</span><span class="s2">&quot;due to a {error.__class__.__name__}:\n{error}&quot;</span>

                <span class="p">)</span>

                <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s s-Atom">error</span><span class="p">,</span> <span class="s s-Atom">exc_info</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

        <span class="s s-Atom">identifier</span> <span class="o">=</span> <span class="s s-Atom">identifier</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">source</span> <span class="o">==</span> <span class="s2">&quot;isbn&quot;</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">from</span> <span class="s s-Atom">isbnlib</span> <span class="s s-Atom">import</span> <span class="s s-Atom">to_isbn13</span>

        <span class="s s-Atom">identifier</span> <span class="o">=</span> <span class="nf">to_isbn13</span><span class="p">(</span><span class="s s-Atom">identifier</span><span class="p">)</span>

    <span class="s s-Atom">standard_citekey</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;{source}:{identifier}&quot;</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">warn_if_changed</span> <span class="s s-Atom">and</span> <span class="s s-Atom">citekey</span> <span class="p">!</span><span class="o">=</span> <span class="s s-Atom">standard_citekey:</span>

        <span class="s s-Atom">logging</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;standardize_citekey expected citekey to already be standardized.\n&quot;</span>

            <span class="s s-Atom">f</span><span class="s2">&quot;Instead citekey was changed from {citekey!r} to {standard_citekey!r}&quot;</span>

        <span class="p">)</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">standard_citekey</span>

<span class="s s-Atom">regexes</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">&quot;arxiv&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span>

        <span class="s s-Atom">r</span><span class="err">&quot;</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">4</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}|[</span><span class="s s-Atom">a</span><span class="o">-</span><span class="s s-Atom">z\-</span><span class="p">]</span><span class="s s-Atom">+</span><span class="p">(</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="nv">A</span><span class="o">-</span><span class="nv">Z</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="s s-Atom">?/</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">7</span><span class="p">})(</span><span class="s s-Atom">v</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="s s-Atom">+</span><span class="p">)</span><span class="s s-Atom">?</span><span class="s2">&quot;</span>

<span class="s2">    ),</span>

<span class="s2">    &quot;</span><span class="s s-Atom">pmid</span><span class="s2">&quot;: re.compile(r&quot;</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">}</span><span class="s2">&quot;),</span>

<span class="s2">    &quot;</span><span class="s s-Atom">pmcid</span><span class="s2">&quot;: re.compile(r&quot;</span><span class="nv">PMC</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="s s-Atom">+</span><span class="s2">&quot;),</span>

<span class="s2">    &quot;</span><span class="s s-Atom">doi</span><span class="s2">&quot;: re.compile(r&quot;</span><span class="mi">10</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span><span class="s s-Atom">/\</span><span class="nv">S</span><span class="s s-Atom">+</span><span class="s2">&quot;),</span>

<span class="s2">    &quot;</span><span class="s s-Atom">shortdoi</span><span class="s2">&quot;: re.compile(r&quot;</span><span class="mi">10</span><span class="o">/</span><span class="p">[</span><span class="s s-Atom">a</span><span class="o">-</span><span class="s s-Atom">zA</span><span class="o">-</span><span class="nv">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="s s-Atom">+</span><span class="s2">&quot;),</span>

<span class="s2">    &quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;: re.compile(r&quot;</span><span class="nv">Q</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="s s-Atom">+</span><span class="s2">&quot;),</span>

<span class="s2">}</span>

<span class="s2">def inspect_citekey(citekey):</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nv">Check</span> <span class="s s-Atom">citekeys</span> <span class="s s-Atom">adhere</span> <span class="s s-Atom">to</span> <span class="s s-Atom">expected</span> <span class="s s-Atom">formats</span><span class="p">.</span> <span class="nv">If</span> <span class="s s-Atom">an</span> <span class="s s-Atom">issue</span> <span class="o">is</span> <span class="s s-Atom">detected</span> <span class="s s-Atom">a</span>

    <span class="s s-Atom">string</span> <span class="s s-Atom">describing</span> <span class="s s-Atom">the</span> <span class="s s-Atom">issue</span> <span class="o">is</span> <span class="s s-Atom">returned</span><span class="p">.</span> <span class="nv">Otherwise</span> <span class="s s-Atom">returns</span> <span class="nv">None</span><span class="p">.</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    source, identifier = citekey.split(&quot;</span><span class="s s-Atom">:</span><span class="s2">&quot;, 1)</span>

<span class="s2">    if source == &quot;</span><span class="s s-Atom">arxiv</span><span class="s2">&quot;:</span>

<span class="s2">        # https://arxiv.org/help/arxiv_identifier</span>

<span class="s2">        if not regexes[&quot;</span><span class="s s-Atom">arxiv</span><span class="s2">&quot;].fullmatch(identifier):</span>

<span class="s2">            return &quot;</span><span class="s s-Atom">arXiv</span> <span class="s s-Atom">identifiers</span> <span class="s s-Atom">must</span> <span class="s s-Atom">conform</span> <span class="s s-Atom">to</span> <span class="s s-Atom">syntax</span> <span class="s s-Atom">described</span> <span class="s s-Atom">at</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="s s-Atom">arxiv</span><span class="p">.</span><span class="s s-Atom">org</span><span class="o">/</span><span class="s s-Atom">help</span><span class="o">/</span><span class="s s-Atom">arxiv_identifier</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">    if source == &quot;</span><span class="s s-Atom">pmid</span><span class="s2">&quot;:</span>

<span class="s2">        # https://www.nlm.nih.gov/bsd/mms/medlineelements.html#pmid</span>

<span class="s2">        if identifier.startswith(&quot;</span><span class="nv">PMC</span><span class="s2">&quot;):</span>

<span class="s2">            return (</span>

<span class="s2">                &quot;</span><span class="nv">PubMed</span> <span class="nv">Identifiers</span> <span class="s s-Atom">should</span> <span class="s s-Atom">start</span> <span class="s s-Atom">with</span> <span class="s s-Atom">digits</span> <span class="s s-Atom">rather</span> <span class="s s-Atom">than</span> <span class="nv">PMC</span><span class="p">.</span> <span class="s2">&quot;</span>

<span class="s2">                f&quot;</span><span class="nv">Should</span> <span class="p">{</span><span class="s s-Atom">citekey</span><span class="p">!</span><span class="s s-Atom">r</span><span class="p">}</span> <span class="s s-Atom">switch</span> <span class="s s-Atom">the</span> <span class="s s-Atom">citation</span> <span class="s s-Atom">source</span> <span class="s s-Atom">to</span> <span class="s s-Atom">&#39;pmcid&#39;?</span><span class="s2">&quot;</span>

<span class="s2">            )</span>

<span class="s2">        elif not regexes[&quot;</span><span class="s s-Atom">pmid</span><span class="s2">&quot;].fullmatch(identifier):</span>

<span class="s2">            return &quot;</span><span class="nv">PubMed</span> <span class="nv">Identifiers</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="mi">1</span><span class="o">-</span><span class="mi">8</span> <span class="s s-Atom">digits</span> <span class="s s-Atom">with</span> <span class="s s-Atom">no</span> <span class="s s-Atom">leading</span> <span class="s s-Atom">zeros</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">    if source == &quot;</span><span class="s s-Atom">pmcid</span><span class="s2">&quot;:</span>

<span class="s2">        # https://www.nlm.nih.gov/bsd/mms/medlineelements.html#pmc</span>

<span class="s2">        if not identifier.startswith(&quot;</span><span class="nv">PMC</span><span class="s2">&quot;):</span>

<span class="s2">            return &quot;</span><span class="nv">PubMed</span> <span class="nv">Central</span> <span class="nv">Identifiers</span> <span class="s s-Atom">must</span> <span class="s s-Atom">start</span> <span class="s s-Atom">with</span> <span class="s s-Atom">&#39;PMC&#39;</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">        elif not regexes[&quot;</span><span class="s s-Atom">pmcid</span><span class="s2">&quot;].fullmatch(identifier):</span>

<span class="s2">            return (</span>

<span class="s2">                &quot;</span><span class="nv">Identifier</span> <span class="s s-Atom">does</span> <span class="o">not</span> <span class="s s-Atom">conform</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="nv">PMCID</span> <span class="s s-Atom">regex</span><span class="p">.</span> <span class="s2">&quot;</span>

<span class="s2">                &quot;</span><span class="nv">Double</span> <span class="s s-Atom">check</span> <span class="s s-Atom">the</span> <span class="nv">PMCID</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">            )</span>

<span class="s2">    if source == &quot;</span><span class="s s-Atom">doi</span><span class="s2">&quot;:</span>

<span class="s2">        if identifier.startswith(&quot;</span><span class="mf">10.</span><span class="s2">&quot;):</span>

<span class="s2">            # https://www.crossref.org/blog/dois-and-matching-regular-expressions/</span>

<span class="s2">            if not regexes[&quot;</span><span class="s s-Atom">doi</span><span class="s2">&quot;].fullmatch(identifier):</span>

<span class="s2">                return (</span>

<span class="s2">                    &quot;</span><span class="nv">Identifier</span> <span class="s s-Atom">does</span> <span class="o">not</span> <span class="s s-Atom">conform</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="nv">DOI</span> <span class="s s-Atom">regex</span><span class="p">.</span> <span class="s2">&quot;</span>

<span class="s2">                    &quot;</span><span class="nv">Double</span> <span class="s s-Atom">check</span> <span class="s s-Atom">the</span> <span class="nv">DOI</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">                )</span>

<span class="s2">        elif identifier.startswith(&quot;</span><span class="mi">10</span><span class="s s-Atom">/</span><span class="s2">&quot;):</span>

<span class="s2">            # shortDOI, see http://shortdoi.org</span>

<span class="s2">            if not regexes[&quot;</span><span class="s s-Atom">shortdoi</span><span class="s2">&quot;].fullmatch(identifier):</span>

<span class="s2">                return (</span>

<span class="s2">                    &quot;</span><span class="nv">Identifier</span> <span class="s s-Atom">does</span> <span class="o">not</span> <span class="s s-Atom">conform</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="s s-Atom">shortDOI</span> <span class="s s-Atom">regex</span><span class="p">.</span> <span class="s2">&quot;</span>

<span class="s2">                    &quot;</span><span class="nv">Double</span> <span class="s s-Atom">check</span> <span class="s s-Atom">the</span> <span class="s s-Atom">shortDOI</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">                )</span>

<span class="s2">        else:</span>

<span class="s2">            return &quot;</span><span class="nv">DOIs</span> <span class="s s-Atom">must</span> <span class="s s-Atom">start</span> <span class="s s-Atom">with</span> <span class="s s-Atom">&#39;10.&#39;</span> <span class="p">(</span><span class="s s-Atom">or</span> <span class="s s-Atom">&#39;10/&#39;</span> <span class="s s-Atom">for</span> <span class="s s-Atom">shortDOIs</span><span class="p">).</span><span class="s2">&quot;</span>

<span class="s2">    if source == &quot;</span><span class="s s-Atom">isbn</span><span class="s2">&quot;:</span>

<span class="s2">        import isbnlib</span>

<span class="s2">        fail = isbnlib.notisbn(identifier, level=&quot;</span><span class="s s-Atom">strict</span><span class="s2">&quot;)</span>

<span class="s2">        if fail:</span>

<span class="s2">            return f&quot;</span><span class="s s-Atom">identifier</span> <span class="s s-Atom">violates</span> <span class="s s-Atom">the</span> <span class="nv">ISBN</span> <span class="s s-Atom">syntax</span> <span class="s s-Atom">according</span> <span class="s s-Atom">to</span> <span class="s s-Atom">isbnlib</span> <span class="s s-Atom">v</span><span class="p">{</span><span class="s s-Atom">isbnlib</span><span class="p">.</span><span class="k">__</span><span class="s s-Atom">version__</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">    if source == &quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;:</span>

<span class="s2">        # https://www.wikidata.org/wiki/Wikidata:Identifiers</span>

<span class="s2">        if not identifier.startswith(&quot;</span><span class="nv">Q</span><span class="s2">&quot;):</span>

<span class="s2">            return &quot;</span><span class="nv">Wikidata</span> <span class="s s-Atom">item</span> <span class="nv">IDs</span> <span class="s s-Atom">must</span> <span class="s s-Atom">start</span> <span class="s s-Atom">with</span> <span class="s s-Atom">&#39;Q&#39;</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">        elif not regexes[&quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;].fullmatch(identifier):</span>

<span class="s2">            return (</span>

<span class="s2">                &quot;</span><span class="nv">Identifier</span> <span class="s s-Atom">does</span> <span class="o">not</span> <span class="s s-Atom">conform</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="nv">Wikidata</span> <span class="s s-Atom">regex</span><span class="p">.</span> <span class="s2">&quot;</span>

<span class="s2">                &quot;</span><span class="nv">Double</span> <span class="s s-Atom">check</span> <span class="s s-Atom">the</span> <span class="s s-Atom">entity</span> <span class="nv">ID</span><span class="p">.</span><span class="s2">&quot;</span>

<span class="s2">            )</span>

<span class="s2">    return None</span>

<span class="s2">def is_valid_citekey(</span>

<span class="s2">    citekey, allow_tag=False, allow_raw=False, allow_pandoc_xnos=False</span>

<span class="s2">):</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nv">Return</span> <span class="nv">True</span> <span class="s s-Atom">if</span> <span class="s s-Atom">citekey</span> <span class="o">is</span> <span class="s s-Atom">a</span> <span class="s s-Atom">properly</span> <span class="s s-Atom">formatted</span> <span class="s s-Atom">string</span><span class="p">.</span> <span class="nv">Return</span> <span class="nv">False</span> <span class="s s-Atom">if</span>

    <span class="s s-Atom">citekey</span> <span class="o">is</span> <span class="o">not</span> <span class="s s-Atom">a</span> <span class="s s-Atom">citation</span> <span class="s s-Atom">or</span> <span class="o">is</span> <span class="s s-Atom">an</span> <span class="s s-Atom">invalid</span> <span class="s s-Atom">citation</span><span class="p">.</span>

    <span class="nv">In</span> <span class="s s-Atom">the</span> <span class="s s-Atom">case</span> <span class="s s-Atom">citekey</span> <span class="o">is</span> <span class="s s-Atom">invalid</span><span class="p">,</span> <span class="s s-Atom">an</span> <span class="s s-Atom">error</span> <span class="o">is</span> <span class="s s-Atom">logged</span><span class="p">.</span> <span class="nv">This</span>

    <span class="s s-Atom">function</span> <span class="s s-Atom">does</span> <span class="o">not</span> <span class="s s-Atom">catch</span> <span class="s s-Atom">all</span> <span class="s s-Atom">invalid</span> <span class="s s-Atom">citekeys</span><span class="p">,</span> <span class="s s-Atom">but</span> <span class="s s-Atom">instead</span> <span class="s s-Atom">performs</span> <span class="s s-Atom">cursory</span>

    <span class="s s-Atom">checks</span><span class="p">,</span> <span class="s s-Atom">such</span> <span class="s s-Atom">as</span> <span class="s s-Atom">ensuring</span> <span class="s s-Atom">citekeys</span> <span class="s s-Atom">adhere</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="s s-Atom">expected</span> <span class="s s-Atom">formats</span><span class="p">.</span> <span class="nv">No</span> <span class="s s-Atom">calls</span> <span class="s s-Atom">to</span>

    <span class="s s-Atom">external</span> <span class="s s-Atom">resources</span> <span class="s s-Atom">are</span> <span class="s s-Atom">used</span> <span class="s s-Atom">by</span> <span class="s s-Atom">these</span> <span class="s s-Atom">checks</span><span class="p">,</span> <span class="s s-Atom">so</span> <span class="s s-Atom">they</span> <span class="s s-Atom">will</span> <span class="o">not</span> <span class="s s-Atom">detect</span>

    <span class="s s-Atom">citekeys</span> <span class="s s-Atom">to</span> <span class="s s-Atom">non</span><span class="o">-</span><span class="s s-Atom">existent</span> <span class="s s-Atom">identifiers</span> <span class="s s-Atom">unless</span> <span class="s s-Atom">those</span> <span class="s s-Atom">identifiers</span> <span class="s s-Atom">violate</span>

    <span class="s s-Atom">their</span> <span class="s s-Atom">source&#39;s syntax.</span>

<span class="s s-Atom">    allow_tag=False, allow_raw=False, and allow_pandoc_xnos=False enable</span>

<span class="s s-Atom">    allowing citekey sources that are valid for Manubot manuscripts, but</span>

<span class="s s-Atom">    likely not elsewhere. allow_tag=True enables citekey tags (e.g.</span>

<span class="s s-Atom">    tag:citation-tag). allow_raw=True enables raw citekeys (e.g.</span>

<span class="s s-Atom">    raw:manual-reference). allow_pandoc_xnos=True still returns False for</span>

<span class="s s-Atom">    pandoc-xnos references (e.g. fig:figure-id), but does not log an error.</span>

<span class="s s-Atom">    With the default of False for these arguments, valid sources are restricted</span>

<span class="s s-Atom">    to those for which manubot can retrieve metadata based only on the</span>

<span class="s s-Atom">    standalone citekey.</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    if not isinstance(citekey, str):</span>

<span class="s s-Atom">        logging.error(</span>

<span class="s s-Atom">            f&quot;citekey should be type &#39;str&#39; not &quot;</span>

<span class="s s-Atom">            f&quot;{type(citekey).__name__!r}: {citekey!r}&quot;</span>

<span class="s s-Atom">        )</span>

<span class="s s-Atom">        return False</span>

<span class="s s-Atom">    if citekey.startswith(&quot;@&quot;):</span>

<span class="s s-Atom">        logging.error(f&quot;invalid citekey: {citekey!r}\nstarts with &#39;@&#39;&quot;)</span>

<span class="s s-Atom">        return False</span>

<span class="s s-Atom">    try:</span>

<span class="s s-Atom">        source, identifier = citekey.split(&quot;:&quot;, 1)</span>

<span class="s s-Atom">    except ValueError:</span>

<span class="s s-Atom">        logging.error(</span>

<span class="s s-Atom">            f&quot;citekey not splittable via a single colon: {citekey}. &quot;</span>

<span class="s s-Atom">            &quot;Citekeys must be in the format of `source:identifier`.&quot;</span>

<span class="s s-Atom">        )</span>

<span class="s s-Atom">        return False</span>

<span class="s s-Atom">    if not source or not identifier:</span>

<span class="s s-Atom">        msg = f&quot;invalid citekey: {citekey!r}\nblank source or identifier&quot;</span>

<span class="s s-Atom">        logging.error(msg)</span>

<span class="s s-Atom">        return False</span>

<span class="s s-Atom">    if allow_pandoc_xnos:</span>

<span class="s s-Atom">        # Exempted non-citation sources used for pandoc-fignos,</span>

<span class="s s-Atom">        # pandoc-tablenos, and pandoc-eqnos</span>

<span class="s s-Atom">        pandoc_xnos_keys = {&quot;fig&quot;, &quot;tbl&quot;, &quot;eq&quot;}</span>

<span class="s s-Atom">        if source in pandoc_xnos_keys:</span>

<span class="s s-Atom">            return False</span>

<span class="s s-Atom">        if source.lower() in pandoc_xnos_keys:</span>

<span class="s s-Atom">            logging.error(</span>

<span class="s s-Atom">                f&quot;pandoc-xnos reference types should be all lowercase.\n&quot;</span>

<span class="s s-Atom">                f&#39;</span><span class="nv">Should</span> <span class="p">{</span><span class="s s-Atom">citekey</span><span class="p">!</span><span class="s s-Atom">r</span><span class="p">}</span> <span class="s s-Atom">use</span> <span class="p">{</span><span class="s s-Atom">source</span><span class="p">.</span><span class="nf">lower</span><span class="p">()!</span><span class="s s-Atom">r</span><span class="p">}</span> <span class="s s-Atom">rather</span> <span class="s s-Atom">than</span> <span class="s2">&quot;{source!r}&quot;</span><span class="s s-Atom">?&#39;</span>

<span class="s s-Atom">            )</span>

<span class="s s-Atom">            return False</span>

<span class="s s-Atom">    # Check supported source type</span>

<span class="s s-Atom">    sources = set(citeproc_retrievers)</span>

<span class="s s-Atom">    if allow_raw:</span>

<span class="s s-Atom">        sources.add(&quot;raw&quot;)</span>

<span class="s s-Atom">    if allow_tag:</span>

<span class="s s-Atom">        sources.add(&quot;tag&quot;)</span>

<span class="s s-Atom">    if source not in sources:</span>

<span class="s s-Atom">        if source.lower() in sources:</span>

<span class="s s-Atom">            logging.error(</span>

<span class="s s-Atom">                f&quot;citekey sources should be all lowercase.\n&quot;</span>

<span class="s s-Atom">                f&#39;</span><span class="nv">Should</span> <span class="p">{</span><span class="s s-Atom">citekey</span><span class="p">}</span> <span class="s s-Atom">use</span> <span class="s2">&quot;{source.lower()}&quot;</span> <span class="s s-Atom">rather</span> <span class="s s-Atom">than</span> <span class="s2">&quot;{source}&quot;</span><span class="s s-Atom">?&#39;</span>

<span class="s s-Atom">            )</span>

<span class="s s-Atom">        else:</span>

<span class="s s-Atom">            logging.error(</span>

<span class="s s-Atom">                f&quot;invalid citekey: {citekey!r}\n&quot;</span>

<span class="s s-Atom">                f&quot;Source {source!r} is not valid.\n&quot;</span>

<span class="s s-Atom">                f&#39;</span><span class="nv">Valid</span> <span class="s s-Atom">citation</span> <span class="s s-Atom">sources</span> <span class="s s-Atom">are</span> <span class="p">{{{</span><span class="s2">&quot;, &quot;</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">sources</span><span class="p">))}}}</span><span class="s s-Atom">&#39;</span>

<span class="s s-Atom">            )</span>

<span class="s s-Atom">        return False</span>

<span class="s s-Atom">    inspection = inspect_citekey(citekey)</span>

<span class="s s-Atom">    if inspection:</span>

<span class="s s-Atom">        logging.error(f&quot;invalid {source} citekey: {citekey}\n{inspection}&quot;)</span>

<span class="s s-Atom">        return False</span>

<span class="s s-Atom">    return True</span>

<span class="s s-Atom">def shorten_citekey(standard_citekey):</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    Return a shortened citekey derived from the input citekey.</span>

<span class="s s-Atom">    The input citekey should be standardized prior to this function,</span>

<span class="s s-Atom">    since differences in the input citekey will result in different shortened citekeys.</span>

<span class="s s-Atom">    Short citekeys are generated by converting the input citekey to a 6 byte hash,</span>

<span class="s s-Atom">    and then converting this digest to a base62 ASCII str. Shortened</span>

<span class="s s-Atom">    citekeys consist of characters in the following ranges: 0-9, a-z and A-Z.</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    import hashlib</span>

<span class="s s-Atom">    import base62</span>

<span class="s s-Atom">    assert not standard_citekey.startswith(&quot;@&quot;)</span>

<span class="s s-Atom">    as_bytes = standard_citekey.encode()</span>

<span class="s s-Atom">    blake_hash = hashlib.blake2b(as_bytes, digest_size=6)</span>

<span class="s s-Atom">    digest = blake_hash.digest()</span>

<span class="s s-Atom">    short_citekey = base62.encodebytes(digest)</span>

<span class="s s-Atom">    return short_citekey</span>

<span class="s s-Atom">def citekey_to_csl_item(citekey, prune=True):</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    Generate a CSL Item (Python dictionary) for the input citekey.</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    from manubot.cite.csl_item import CSL_Item</span>

<span class="s s-Atom">    from manubot import __version__ as manubot_version</span>

<span class="s s-Atom">    citekey == standardize_citekey(citekey, warn_if_changed=True)</span>

<span class="s s-Atom">    source, identifier = citekey.split(&quot;:&quot;, 1)</span>

<span class="s s-Atom">    if source not in citeproc_retrievers:</span>

<span class="s s-Atom">        msg = f&quot;Unsupported citation source {source!r} in {citekey!r}&quot;</span>

<span class="s s-Atom">        raise ValueError(msg)</span>

<span class="s s-Atom">    citeproc_retriever = import_function(citeproc_retrievers[source])</span>

<span class="s s-Atom">    csl_item = citeproc_retriever(identifier)</span>

<span class="s s-Atom">    csl_item = CSL_Item(csl_item)</span>

<span class="s s-Atom">    note_text = f&quot;This CSL JSON Item was automatically generated by Manubot v{manubot_version} using citation-by-identifier.&quot;</span>

<span class="s s-Atom">    note_dict = {&quot;standard_id&quot;: citekey}</span>

<span class="s s-Atom">    csl_item.note_append_text(note_text)</span>

<span class="s s-Atom">    csl_item.note_append_dict(note_dict)</span>

<span class="s s-Atom">    short_citekey = shorten_citekey(citekey)</span>

<span class="s s-Atom">    csl_item.set_id(short_citekey)</span>

<span class="s s-Atom">    csl_item.clean(prune=prune)</span>

<span class="s s-Atom">    return csl_item</span>

<span class="s s-Atom">def infer_citekey_prefix(citekey):</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    Passthrough citekey if it has a valid citation key prefix. Otherwise,</span>

<span class="s s-Atom">    if the lowercase citekey prefix is valid, convert the prefix to lowercase.</span>

<span class="s s-Atom">    Otherwise, assume citekey is raw and prepend &quot;raw:&quot;.</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    prefixes = [f&quot;{x}:&quot; for x in list(citeproc_retrievers) + [&quot;raw&quot;]]</span>

<span class="s s-Atom">    for prefix in prefixes:</span>

<span class="s s-Atom">        if citekey.startswith(prefix):</span>

<span class="s s-Atom">            return citekey</span>

<span class="s s-Atom">        if citekey.lower().startswith(prefix):</span>

<span class="s s-Atom">            return prefix + citekey[len(prefix) :]</span>

<span class="s s-Atom">    return f&quot;raw:{citekey}&quot;</span>

<span class="s s-Atom">def url_to_citekey(url):</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    Convert a HTTP(s) URL into a citekey.</span>

<span class="s s-Atom">    For supported sources, convert from url citekey to an alternative source like doi.</span>

<span class="s s-Atom">    If citekeys fail inspection, revert alternative sources to URLs.</span>

<span class="s s-Atom">    &quot;&quot;&quot;</span>

<span class="s s-Atom">    from urllib.parse import urlparse, unquote</span>

<span class="s s-Atom">    citekey = None</span>

<span class="s s-Atom">    parsed_url = urlparse(url)</span>

<span class="s s-Atom">    if parsed_url.hostname.split(&quot;.&quot;)[-2:] == [&quot;doi&quot;, &quot;org&quot;]:</span>

<span class="s s-Atom">        # DOI URLs</span>

<span class="s s-Atom">        doi = unquote(parsed_url.path.lstrip(&quot;/&quot;))</span>

<span class="s s-Atom">        citekey = f&quot;doi:{doi}&quot;</span>

<span class="s s-Atom">    if parsed_url.hostname.split(&quot;.&quot;)[-2:] == [&quot;biorxiv&quot;, &quot;org&quot;]:</span>

<span class="s s-Atom">        # bioRxiv URL to DOI. See https://git.io/Je9Hq</span>

<span class="s s-Atom">        match = re.search(</span>

<span class="s s-Atom">            r&quot;/(?P&lt;biorxiv_id&gt;([0-9]{4}\.[0-9]{2}\.[0-9]{2}\.)?[0-9]{6,})&quot;,</span>

<span class="s s-Atom">            parsed_url.path,</span>

<span class="s s-Atom">        )</span>

<span class="s s-Atom">        if match:</span>

<span class="s s-Atom">            citekey = f&quot;doi:10.1101/{match.group(&#39;biorxiv_id</span><span class="err">&#39;</span><span class="p">)}</span><span class="s2">&quot;</span>

<span class="s2">    is_ncbi_url = parsed_url.hostname.endswith(&quot;</span><span class="s s-Atom">ncbi</span><span class="p">.</span><span class="s s-Atom">nlm</span><span class="p">.</span><span class="s s-Atom">nih</span><span class="p">.</span><span class="s s-Atom">gov</span><span class="s2">&quot;)</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pubmed/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmid</span><span class="p">:{</span><span class="s s-Atom">pmid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pmc/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed Central URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmcid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[3]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmcid</span><span class="p">:{</span><span class="s s-Atom">pmcid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if parsed_url.hostname.split(&quot;</span><span class="p">.</span><span class="s2">&quot;)[-2:] == [</span>

<span class="s2">        &quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;,</span>

<span class="s2">        &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;,</span>

<span class="s2">    ] and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">wiki/</span><span class="s2">&quot;):</span>

<span class="s2">        # Wikidata URLs</span>

<span class="s2">        try:</span>

<span class="s2">            wikidata_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">wikidata</span><span class="p">:{</span><span class="s s-Atom">wikidata_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if parsed_url.hostname.split(&quot;</span><span class="p">.</span><span class="s2">&quot;)[-2:] == [&quot;</span><span class="s s-Atom">arxiv</span><span class="s2">&quot;, &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;]:</span>

<span class="s2">        # arXiv identifiers. See https://arxiv.org/help/arxiv_identifier</span>

<span class="s2">        try:</span>

<span class="s2">            arxiv_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;, maxsplit=2)[2]</span>

<span class="s2">            if arxiv_id.endswith(&quot;</span><span class="p">.</span><span class="s s-Atom">pdf</span><span class="s2">&quot;):</span>

<span class="s2">                arxiv_id = arxiv_id[:-4]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">arxiv</span><span class="p">:{</span><span class="s s-Atom">arxiv_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if citekey is None or inspect_citekey(citekey) is not None:</span>

<span class="s2">        citekey = f&quot;</span><span class="nn">url</span><span class="p">:{</span><span class="s s-Atom">url</span><span class="p">}</span><span class="err">&quot;</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">citekey</span>
</pre></div>


</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><span class="n">citekey_pattern</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">citeproc_retrievers</span>
</pre></div>


<p>Regex to extract citation keys.
The leading '@' is omitted from the single match group.</p>
<p>Same rules as pandoc, except more permissive in the following ways:</p>
<ol>
<li>the final character can be a slash because many URLs end in a slash.</li>
<li>underscores are allowed in internal characters because URLs, DOIs, and
   citation tags often contain underscores.</li>
</ol>
<p>If a citekey does not match this regex, it can be substituted for a
tag that does, as defined in citation-tags.tsv.</p>
<p>https://github.com/greenelab/manubot-rootstock/issues/2#issuecomment-312153192</p>
<p>Prototyped at https://regex101.com/r/s3Asz3/4</p>
<div class="codehilite"><pre><span></span><span class="n">regexes</span>
</pre></div>


<h2 id="functions">Functions</h2>
<h3 id="citekey_to_csl_item">citekey_to_csl_item</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">citekey_to_csl_item</span><span class="p">(</span>
    <span class="n">citekey</span><span class="p">,</span>
    <span class="n">prune</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>


<p>Generate a CSL Item (Python dictionary) for the input citekey.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">citekey_to_csl_item</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Generate a CSL Item (Python dictionary) for the input citekey.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">manubot.cite.csl_item</span> <span class="kn">import</span> <span class="n">CSL_Item</span>

    <span class="kn">from</span> <span class="nn">manubot</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">manubot_version</span>

    <span class="n">citekey</span> <span class="o">==</span> <span class="n">standardize_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span> <span class="n">warn_if_changed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">source</span><span class="p">,</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">citekey</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">citeproc_retrievers</span><span class="p">:</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Unsupported citation source {source!r} in {citekey!r}&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">citeproc_retriever</span> <span class="o">=</span> <span class="n">import_function</span><span class="p">(</span><span class="n">citeproc_retrievers</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>

    <span class="n">csl_item</span> <span class="o">=</span> <span class="n">citeproc_retriever</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

    <span class="n">csl_item</span> <span class="o">=</span> <span class="n">CSL_Item</span><span class="p">(</span><span class="n">csl_item</span><span class="p">)</span>

    <span class="n">note_text</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;This CSL JSON Item was automatically generated by Manubot v{manubot_version} using citation-by-identifier.&quot;</span>

    <span class="n">note_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;standard_id&quot;</span><span class="p">:</span> <span class="n">citekey</span><span class="p">}</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">note_append_text</span><span class="p">(</span><span class="n">note_text</span><span class="p">)</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">note_append_dict</span><span class="p">(</span><span class="n">note_dict</span><span class="p">)</span>

    <span class="n">short_citekey</span> <span class="o">=</span> <span class="n">shorten_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">)</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="n">short_citekey</span><span class="p">)</span>

    <span class="n">csl_item</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="n">prune</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">csl_item</span>
</pre></div>


</details>
<h3 id="infer_citekey_prefix">infer_citekey_prefix</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">infer_citekey_prefix</span><span class="p">(</span>
    <span class="n">citekey</span>
<span class="p">)</span>
</pre></div>


<p>Passthrough citekey if it has a valid citation key prefix. Otherwise,
if the lowercase citekey prefix is valid, convert the prefix to lowercase.
Otherwise, assume citekey is raw and prepend "raw:".</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>def infer_citekey_prefix<span class="p">(</span>citekey<span class="p">):</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Passthrough citekey if it has a valid citation key prefix. Otherwise,</span>

<span class="s2">    if the lowercase citekey prefix is valid, convert the prefix to lowercase.</span>

<span class="s2">    Otherwise, assume citekey is raw and prepend &quot;</span>raw<span class="p">:</span><span class="s2">&quot;.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="ss">prefixes =</span> <span class="p">[</span>f<span class="s2">&quot;{x}:&quot;</span> for x <span class="k">in</span> list<span class="p">(</span>citeproc_retrievers<span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]]</span>

    for prefix <span class="k">in</span> prefixes<span class="p">:</span>

        <span class="k">if</span> citekey<span class="o">.</span>startswith<span class="p">(</span>prefix<span class="p">):</span>

            return citekey

        <span class="k">if</span> citekey<span class="o">.</span>lower<span class="p">()</span><span class="o">.</span>startswith<span class="p">(</span>prefix<span class="p">):</span>

            return prefix <span class="o">+</span> citekey<span class="p">[</span>len<span class="p">(</span>prefix<span class="p">)</span> <span class="p">:]</span>

    return f<span class="s2">&quot;raw:{citekey}&quot;</span>
</pre></div>


</details>
<h3 id="inspect_citekey">inspect_citekey</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inspect_citekey</span><span class="p">(</span>
    <span class="n">citekey</span>
<span class="p">)</span>
</pre></div>


<p>Check citekeys adhere to expected formats. If an issue is detected a
string describing the issue is returned. Otherwise returns None.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">inspect_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">):</span>

    <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">    Check citekeys adhere to expected formats. If an issue is detected a</span>

<span class="ss">    string describing the issue is returned. Otherwise returns None.</span>

<span class="ss">    &quot;&quot;&quot;</span>

    <span class="k">source</span><span class="p">,</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">citekey</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="ss">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="k">source</span> <span class="o">==</span> <span class="ss">&quot;arxiv&quot;</span><span class="p">:</span>

        <span class="o">#</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">arxiv</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">help</span><span class="o">/</span><span class="n">arxiv_identifier</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">regexes</span><span class="p">[</span><span class="ss">&quot;arxiv&quot;</span><span class="p">].</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>

            <span class="k">return</span> <span class="ss">&quot;arXiv identifiers must conform to syntax described at https://arxiv.org/help/arxiv_identifier.&quot;</span>

    <span class="k">if</span> <span class="k">source</span> <span class="o">==</span> <span class="ss">&quot;pmid&quot;</span><span class="p">:</span>

        <span class="o">#</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">nlm</span><span class="p">.</span><span class="n">nih</span><span class="p">.</span><span class="n">gov</span><span class="o">/</span><span class="n">bsd</span><span class="o">/</span><span class="n">mms</span><span class="o">/</span><span class="n">medlineelements</span><span class="p">.</span><span class="n">html</span><span class="o">#</span><span class="n">pmid</span>

        <span class="k">if</span> <span class="n">identifier</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="ss">&quot;PMC&quot;</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">(</span>

                <span class="ss">&quot;PubMed Identifiers should start with digits rather than PMC. &quot;</span>

                <span class="n">f</span><span class="ss">&quot;Should {citekey!r} switch the citation source to &#39;pmcid&#39;?&quot;</span>

            <span class="p">)</span>

        <span class="n">elif</span> <span class="k">not</span> <span class="n">regexes</span><span class="p">[</span><span class="ss">&quot;pmid&quot;</span><span class="p">].</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>

            <span class="k">return</span> <span class="ss">&quot;PubMed Identifiers should be 1-8 digits with no leading zeros.&quot;</span>

    <span class="k">if</span> <span class="k">source</span> <span class="o">==</span> <span class="ss">&quot;pmcid&quot;</span><span class="p">:</span>

        <span class="o">#</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">nlm</span><span class="p">.</span><span class="n">nih</span><span class="p">.</span><span class="n">gov</span><span class="o">/</span><span class="n">bsd</span><span class="o">/</span><span class="n">mms</span><span class="o">/</span><span class="n">medlineelements</span><span class="p">.</span><span class="n">html</span><span class="o">#</span><span class="n">pmc</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">identifier</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="ss">&quot;PMC&quot;</span><span class="p">):</span>

            <span class="k">return</span> <span class="ss">&quot;PubMed Central Identifiers must start with &#39;PMC&#39;.&quot;</span>

        <span class="n">elif</span> <span class="k">not</span> <span class="n">regexes</span><span class="p">[</span><span class="ss">&quot;pmcid&quot;</span><span class="p">].</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">(</span>

                <span class="ss">&quot;Identifier does not conform to the PMCID regex. &quot;</span>

                <span class="ss">&quot;Double check the PMCID.&quot;</span>

            <span class="p">)</span>

    <span class="k">if</span> <span class="k">source</span> <span class="o">==</span> <span class="ss">&quot;doi&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">identifier</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="ss">&quot;10.&quot;</span><span class="p">):</span>

            <span class="o">#</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">crossref</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span><span class="n">dois</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">matching</span><span class="o">-</span><span class="n">regular</span><span class="o">-</span><span class="n">expressions</span><span class="o">/</span>

            <span class="k">if</span> <span class="k">not</span> <span class="n">regexes</span><span class="p">[</span><span class="ss">&quot;doi&quot;</span><span class="p">].</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>

                <span class="k">return</span> <span class="p">(</span>

                    <span class="ss">&quot;Identifier does not conform to the DOI regex. &quot;</span>

                    <span class="ss">&quot;Double check the DOI.&quot;</span>

                <span class="p">)</span>

        <span class="n">elif</span> <span class="n">identifier</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="ss">&quot;10/&quot;</span><span class="p">):</span>

            <span class="o">#</span> <span class="n">shortDOI</span><span class="p">,</span> <span class="n">see</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">shortdoi</span><span class="p">.</span><span class="n">org</span>

            <span class="k">if</span> <span class="k">not</span> <span class="n">regexes</span><span class="p">[</span><span class="ss">&quot;shortdoi&quot;</span><span class="p">].</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>

                <span class="k">return</span> <span class="p">(</span>

                    <span class="ss">&quot;Identifier does not conform to the shortDOI regex. &quot;</span>

                    <span class="ss">&quot;Double check the shortDOI.&quot;</span>

                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="ss">&quot;DOIs must start with &#39;10.&#39; (or &#39;10/&#39; for shortDOIs).&quot;</span>

    <span class="k">if</span> <span class="k">source</span> <span class="o">==</span> <span class="ss">&quot;isbn&quot;</span><span class="p">:</span>

        <span class="n">import</span> <span class="n">isbnlib</span>

        <span class="n">fail</span> <span class="o">=</span> <span class="n">isbnlib</span><span class="p">.</span><span class="n">notisbn</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="k">level</span><span class="o">=</span><span class="ss">&quot;strict&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fail</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">f</span><span class="ss">&quot;identifier violates the ISBN syntax according to isbnlib v{isbnlib.__version__}&quot;</span>

    <span class="k">if</span> <span class="k">source</span> <span class="o">==</span> <span class="ss">&quot;wikidata&quot;</span><span class="p">:</span>

        <span class="o">#</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">wikidata</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">Wikidata</span><span class="p">:</span><span class="n">Identifiers</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">identifier</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="ss">&quot;Q&quot;</span><span class="p">):</span>

            <span class="k">return</span> <span class="ss">&quot;Wikidata item IDs must start with &#39;Q&#39;.&quot;</span>

        <span class="n">elif</span> <span class="k">not</span> <span class="n">regexes</span><span class="p">[</span><span class="ss">&quot;wikidata&quot;</span><span class="p">].</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">(</span>

                <span class="ss">&quot;Identifier does not conform to the Wikidata regex. &quot;</span>

                <span class="ss">&quot;Double check the entity ID.&quot;</span>

            <span class="p">)</span>

    <span class="k">return</span> <span class="k">None</span>
</pre></div>


</details>
<h3 id="is_valid_citekey">is_valid_citekey</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_valid_citekey</span><span class="p">(</span>
    <span class="n">citekey</span><span class="p">,</span>
    <span class="n">allow_tag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_pandoc_xnos</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>


<p>Return True if citekey is a properly formatted string. Return False if
citekey is not a citation or is an invalid citation.</p>
<p>In the case citekey is invalid, an error is logged. This
function does not catch all invalid citekeys, but instead performs cursory
checks, such as ensuring citekeys adhere to the expected formats. No calls to
external resources are used by these checks, so they will not detect
citekeys to non-existent identifiers unless those identifiers violate
their source's syntax.</p>
<p>allow_tag=False, allow_raw=False, and allow_pandoc_xnos=False enable
allowing citekey sources that are valid for Manubot manuscripts, but
likely not elsewhere. allow_tag=True enables citekey tags (e.g.
tag:citation-tag). allow_raw=True enables raw citekeys (e.g.
raw:manual-reference). allow_pandoc_xnos=True still returns False for
pandoc-xnos references (e.g. fig:figure-id), but does not log an error.
With the default of False for these arguments, valid sources are restricted
to those for which manubot can retrieve metadata based only on the
standalone citekey.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="n">def</span> <span class="nf">is_valid_citekey</span><span class="p">(</span>

    <span class="n">citekey</span><span class="p">,</span> <span class="n">allow_tag</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">allow_raw</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">allow_pandoc_xnos</span><span class="o">=</span><span class="n">False</span>

<span class="p">)</span><span class="o">:</span>

    <span class="s">&quot;&quot;&quot;</span>

    <span class="n">Return</span> <span class="n">True</span> <span class="k">if</span> <span class="n">citekey</span> <span class="n">is</span> <span class="n">a</span> <span class="n">properly</span> <span class="n">formatted</span> <span class="n">string</span><span class="p">.</span> <span class="n">Return</span> <span class="n">False</span> <span class="k">if</span>

    <span class="n">citekey</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">citation</span> <span class="n">or</span> <span class="n">is</span> <span class="n">an</span> <span class="n">invalid</span> <span class="n">citation</span><span class="p">.</span>

    <span class="n">In</span> <span class="n">the</span> <span class="k">case</span> <span class="n">citekey</span> <span class="n">is</span> <span class="n">invalid</span><span class="p">,</span> <span class="n">an</span> <span class="n">error</span> <span class="n">is</span> <span class="n">logged</span><span class="p">.</span> <span class="n">This</span>

    <span class="n">function</span> <span class="n">does</span> <span class="n">not</span> <span class="n">catch</span> <span class="n">all</span> <span class="n">invalid</span> <span class="n">citekeys</span><span class="p">,</span> <span class="n">but</span> <span class="n">instead</span> <span class="n">performs</span> <span class="n">cursory</span>

    <span class="n">checks</span><span class="p">,</span> <span class="n">such</span> <span class="n">as</span> <span class="n">ensuring</span> <span class="n">citekeys</span> <span class="n">adhere</span> <span class="n">to</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">formats</span><span class="p">.</span> <span class="n">No</span> <span class="n">calls</span> <span class="n">to</span>

    <span class="n">external</span> <span class="n">resources</span> <span class="n">are</span> <span class="n">used</span> <span class="n">by</span> <span class="n">these</span> <span class="n">checks</span><span class="p">,</span> <span class="n">so</span> <span class="n">they</span> <span class="n">will</span> <span class="n">not</span> <span class="n">detect</span>

    <span class="n">citekeys</span> <span class="n">to</span> <span class="n">non</span><span class="o">-</span><span class="n">existent</span> <span class="n">identifiers</span> <span class="n">unless</span> <span class="n">those</span> <span class="n">identifiers</span> <span class="n">violate</span>

    <span class="n">their</span> <span class="n">source</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">syntax</span><span class="p">.</span>

    <span class="n">allow_tag</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">allow_raw</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">and</span> <span class="n">allow_pandoc_xnos</span><span class="o">=</span><span class="n">False</span> <span class="n">enable</span>

    <span class="n">allowing</span> <span class="n">citekey</span> <span class="n">sources</span> <span class="n">that</span> <span class="n">are</span> <span class="n">valid</span> <span class="k">for</span> <span class="n">Manubot</span> <span class="n">manuscripts</span><span class="p">,</span> <span class="n">but</span>

    <span class="n">likely</span> <span class="n">not</span> <span class="n">elsewhere</span><span class="p">.</span> <span class="n">allow_tag</span><span class="o">=</span><span class="n">True</span> <span class="n">enables</span> <span class="n">citekey</span> <span class="n">tags</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span>

    <span class="nl">tag</span><span class="p">:</span><span class="n">citation</span><span class="o">-</span><span class="n">tag</span><span class="p">).</span> <span class="n">allow_raw</span><span class="o">=</span><span class="n">True</span> <span class="n">enables</span> <span class="n">raw</span> <span class="n">citekeys</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span>

    <span class="nl">raw</span><span class="p">:</span><span class="n">manual</span><span class="o">-</span><span class="n">reference</span><span class="p">).</span> <span class="n">allow_pandoc_xnos</span><span class="o">=</span><span class="n">True</span> <span class="n">still</span> <span class="n">returns</span> <span class="n">False</span> <span class="k">for</span>

    <span class="n">pandoc</span><span class="o">-</span><span class="n">xnos</span> <span class="n">references</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="nl">fig</span><span class="p">:</span><span class="n">figure</span><span class="o">-</span><span class="kt">id</span><span class="p">),</span> <span class="n">but</span> <span class="n">does</span> <span class="n">not</span> <span class="n">log</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span>

    <span class="n">With</span> <span class="n">the</span> <span class="k">default</span> <span class="n">of</span> <span class="n">False</span> <span class="k">for</span> <span class="n">these</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">valid</span> <span class="n">sources</span> <span class="n">are</span> <span class="k">restricted</span>

    <span class="n">to</span> <span class="n">those</span> <span class="k">for</span> <span class="n">which</span> <span class="n">manubot</span> <span class="n">can</span> <span class="n">retrieve</span> <span class="n">metadata</span> <span class="n">based</span> <span class="n">only</span> <span class="n">on</span> <span class="n">the</span>

    <span class="n">standalone</span> <span class="n">citekey</span><span class="p">.</span>

    <span class="s">&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">not</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span><span class="o">:</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>

            <span class="n">f</span><span class="s">&quot;citekey should be type &#39;str&#39; not &quot;</span>

            <span class="n">f</span><span class="s">&quot;</span><span class="p">{</span><span class="n">type</span><span class="p">(</span><span class="n">citekey</span><span class="p">).</span><span class="n">__name__</span><span class="o">!</span><span class="n">r</span><span class="p">}</span><span class="o">:</span> <span class="p">{</span><span class="n">citekey</span><span class="o">!</span><span class="n">r</span><span class="p">}</span><span class="s">&quot;</span>

        <span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>

    <span class="k">if</span> <span class="n">citekey</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span><span class="o">:</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;invalid citekey: {citekey!r}</span><span class="se">\n</span><span class="s">starts with &#39;@&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>

    <span class="nl">try</span><span class="p">:</span>

        <span class="n">source</span><span class="p">,</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">citekey</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">except</span> <span class="nl">ValueError</span><span class="p">:</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>

            <span class="n">f</span><span class="s">&quot;citekey not splittable via a single colon: {citekey}. &quot;</span>

            <span class="s">&quot;Citekeys must be in the format of `source:identifier`.&quot;</span>

        <span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>

    <span class="k">if</span> <span class="n">not</span> <span class="n">source</span> <span class="n">or</span> <span class="n">not</span> <span class="nl">identifier</span><span class="p">:</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="s">&quot;invalid citekey: {citekey!r}</span><span class="se">\n</span><span class="s">blank source or identifier&quot;</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>

    <span class="k">if</span> <span class="nl">allow_pandoc_xnos</span><span class="p">:</span>

        <span class="cp"># Exempted non-citation sources used for pandoc-fignos,</span>

        <span class="cp"># pandoc-tablenos, and pandoc-eqnos</span>

        <span class="n">pandoc_xnos_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;fig&quot;</span><span class="p">,</span> <span class="s">&quot;tbl&quot;</span><span class="p">,</span> <span class="s">&quot;eq&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">source</span> <span class="k">in</span> <span class="nl">pandoc_xnos_keys</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">False</span>

        <span class="k">if</span> <span class="n">source</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">in</span> <span class="nl">pandoc_xnos_keys</span><span class="p">:</span>

            <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>

                <span class="n">f</span><span class="s">&quot;pandoc-xnos reference types should be all lowercase.</span><span class="se">\n</span><span class="s">&quot;</span>

                <span class="n">f</span><span class="err">&#39;</span><span class="n">Should</span> <span class="p">{</span><span class="n">citekey</span><span class="o">!</span><span class="n">r</span><span class="p">}</span> <span class="n">use</span> <span class="p">{</span><span class="n">source</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!</span><span class="n">r</span><span class="p">}</span> <span class="n">rather</span> <span class="n">than</span> <span class="s">&quot;{source!r}&quot;</span><span class="o">?</span><span class="err">&#39;</span>

            <span class="p">)</span>

            <span class="k">return</span> <span class="n">False</span>

    <span class="cp"># Check supported source type</span>

    <span class="n">sources</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="n">citeproc_retrievers</span><span class="p">)</span>

    <span class="k">if</span> <span class="nl">allow_raw</span><span class="p">:</span>

        <span class="n">sources</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;raw&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nl">allow_tag</span><span class="p">:</span>

        <span class="n">sources</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;tag&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source</span> <span class="n">not</span> <span class="k">in</span> <span class="nl">sources</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">source</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">in</span> <span class="nl">sources</span><span class="p">:</span>

            <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>

                <span class="n">f</span><span class="s">&quot;citekey sources should be all lowercase.</span><span class="se">\n</span><span class="s">&quot;</span>

                <span class="n">f</span><span class="err">&#39;</span><span class="n">Should</span> <span class="p">{</span><span class="n">citekey</span><span class="p">}</span> <span class="n">use</span> <span class="s">&quot;{source.lower()}&quot;</span> <span class="n">rather</span> <span class="n">than</span> <span class="s">&quot;{source}&quot;</span><span class="o">?</span><span class="err">&#39;</span>

            <span class="p">)</span>

        <span class="k">else</span><span class="o">:</span>

            <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>

                <span class="n">f</span><span class="s">&quot;invalid citekey: {citekey!r}</span><span class="se">\n</span><span class="s">&quot;</span>

                <span class="n">f</span><span class="s">&quot;Source {source!r} is not valid.</span><span class="se">\n</span><span class="s">&quot;</span>

                <span class="n">f</span><span class="err">&#39;</span><span class="n">Valid</span> <span class="n">citation</span> <span class="n">sources</span> <span class="n">are</span> <span class="p">{{{</span><span class="s">&quot;, &quot;</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">sources</span><span class="p">))}}}</span><span class="err">&#39;</span>

            <span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>

    <span class="n">inspection</span> <span class="o">=</span> <span class="n">inspect_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">)</span>

    <span class="k">if</span> <span class="nl">inspection</span><span class="p">:</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;invalid {source} citekey: {citekey}</span><span class="se">\n</span><span class="s">{inspection}&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">False</span>

    <span class="k">return</span> <span class="n">True</span>
</pre></div>


</details>
<h3 id="shorten_citekey">shorten_citekey</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">shorten_citekey</span><span class="p">(</span>
    <span class="n">standard_citekey</span>
<span class="p">)</span>
</pre></div>


<p>Return a shortened citekey derived from the input citekey.
The input citekey should be standardized prior to this function,
since differences in the input citekey will result in different shortened citekeys.
Short citekeys are generated by converting the input citekey to a 6 byte hash,
and then converting this digest to a base62 ASCII str. Shortened
citekeys consist of characters in the following ranges: 0-9, a-z and A-Z.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">shorten_citekey</span><span class="p">(</span><span class="n">standard_citekey</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Return a shortened citekey derived from the input citekey.</span>

<span class="sd">    The input citekey should be standardized prior to this function,</span>

<span class="sd">    since differences in the input citekey will result in different shortened citekeys.</span>

<span class="sd">    Short citekeys are generated by converting the input citekey to a 6 byte hash,</span>

<span class="sd">    and then converting this digest to a base62 ASCII str. Shortened</span>

<span class="sd">    citekeys consist of characters in the following ranges: 0-9, a-z and A-Z.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">hashlib</span>

    <span class="kn">import</span> <span class="nn">base62</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">standard_citekey</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>

    <span class="n">as_bytes</span> <span class="o">=</span> <span class="n">standard_citekey</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="n">blake_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">blake2b</span><span class="p">(</span><span class="n">as_bytes</span><span class="p">,</span> <span class="n">digest_size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">digest</span> <span class="o">=</span> <span class="n">blake_hash</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

    <span class="n">short_citekey</span> <span class="o">=</span> <span class="n">base62</span><span class="o">.</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">short_citekey</span>
</pre></div>


</details>
<h3 id="standardize_citekey">standardize_citekey</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">standardize_citekey</span><span class="p">(</span>
    <span class="n">citekey</span><span class="p">,</span>
    <span class="n">warn_if_changed</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>


<p>Standardize citation keys based on their source</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">5</span><span class="n">_000</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">standardize_citekey</span><span class="p">(</span><span class="n">citekey</span><span class="p">,</span> <span class="n">warn_if_changed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Standardize citation keys based on their source</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span><span class="p">,</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">citekey</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;doi&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">identifier</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;10/&quot;</span><span class="p">):</span>

            <span class="kn">from</span> <span class="nn">manubot.cite.doi</span> <span class="kn">import</span> <span class="n">expand_short_doi</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="n">identifier</span> <span class="o">=</span> <span class="n">expand_short_doi</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>

                <span class="c1"># If DOI shortening fails, return the unshortened DOI.</span>

                <span class="c1"># DOI metadata lookup will eventually fail somewhere with</span>

                <span class="c1"># appropriate error handling, as opposed to here.</span>

                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>

                    <span class="n">f</span><span class="s2">&quot;Error in expand_short_doi for {identifier} &quot;</span>

                    <span class="n">f</span><span class="s2">&quot;due to a {error.__class__.__name__}:</span><span class="se">\n</span><span class="s2">{error}&quot;</span>

                <span class="p">)</span>

                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;isbn&quot;</span><span class="p">:</span>

        <span class="kn">from</span> <span class="nn">isbnlib</span> <span class="kn">import</span> <span class="n">to_isbn13</span>

        <span class="n">identifier</span> <span class="o">=</span> <span class="n">to_isbn13</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

    <span class="n">standard_citekey</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;{source}:{identifier}&quot;</span>

    <span class="k">if</span> <span class="n">warn_if_changed</span> <span class="ow">and</span> <span class="n">citekey</span> <span class="o">!=</span> <span class="n">standard_citekey</span><span class="p">:</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>

            <span class="n">f</span><span class="s2">&quot;standardize_citekey expected citekey to already be standardized.</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">f</span><span class="s2">&quot;Instead citekey was changed from {citekey!r} to {standard_citekey!r}&quot;</span>

        <span class="p">)</span>

    <span class="k">return</span> <span class="n">standard_citekey</span>
</pre></div>


</details>
<h3 id="url_to_citekey">url_to_citekey</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">url_to_citekey</span><span class="p">(</span>
    <span class="n">url</span>
<span class="p">)</span>
</pre></div>


<p>Convert a HTTP(s) URL into a citekey.
For supported sources, convert from url citekey to an alternative source like doi.
If citekeys fail inspection, revert alternative sources to URLs.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="s s-Atom">def</span> <span class="nf">url_to_citekey</span><span class="p">(</span><span class="s s-Atom">url</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Convert a HTTP(s) URL into a citekey.</span>

<span class="s2">    For supported sources, convert from url citekey to an alternative source like doi.</span>

<span class="s2">    If citekeys fail inspection, revert alternative sources to URLs.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">from</span> <span class="s s-Atom">urllib</span><span class="p">.</span><span class="s s-Atom">parse</span> <span class="s s-Atom">import</span> <span class="s s-Atom">urlparse</span><span class="p">,</span> <span class="s s-Atom">unquote</span>

    <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="nv">None</span>

    <span class="s s-Atom">parsed_url</span> <span class="o">=</span> <span class="nf">urlparse</span><span class="p">(</span><span class="s s-Atom">url</span><span class="p">)</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">hostname</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="s s-Atom">:</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">]</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="nv">DOI</span> <span class="nv">URLs</span>

        <span class="s s-Atom">doi</span> <span class="o">=</span> <span class="nf">unquote</span><span class="p">(</span><span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>

        <span class="s s-Atom">citekey</span> <span class="o">=</span> <span class="s s-Atom">f</span><span class="s2">&quot;doi:{doi}&quot;</span>

    <span class="s s-Atom">if</span> <span class="s s-Atom">parsed_url</span><span class="p">.</span><span class="s s-Atom">hostname</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="s s-Atom">:</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;biorxiv&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">]</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">#</span> <span class="s s-Atom">bioRxiv</span> <span class="nv">URL</span> <span class="s s-Atom">to</span> <span class="nv">DOI</span><span class="p">.</span> <span class="nv">See</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="s s-Atom">git</span><span class="p">.</span><span class="s s-Atom">io</span><span class="o">/</span><span class="nv">Je9Hq</span>

        <span class="s s-Atom">match</span> <span class="o">=</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>

            <span class="s s-Atom">r</span><span class="err">&quot;</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">?</span><span class="nv">P</span><span class="o">&lt;</span><span class="s s-Atom">biorxiv_id&gt;</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">4</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">}</span><span class="s s-Atom">\.</span><span class="p">)</span><span class="s s-Atom">?</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">6</span><span class="p">,})</span><span class="s2">&quot;,</span>

<span class="s2">            parsed_url.path,</span>

<span class="s2">        )</span>

<span class="s2">        if match:</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">doi</span><span class="p">:</span><span class="mf">10.1101</span><span class="s s-Atom">/</span><span class="p">{</span><span class="s s-Atom">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="s s-Atom">&#39;biorxiv_id&#39;</span><span class="p">)}</span><span class="s2">&quot;</span>

<span class="s2">    is_ncbi_url = parsed_url.hostname.endswith(&quot;</span><span class="s s-Atom">ncbi</span><span class="p">.</span><span class="s s-Atom">nlm</span><span class="p">.</span><span class="s s-Atom">nih</span><span class="p">.</span><span class="s s-Atom">gov</span><span class="s2">&quot;)</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pubmed/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmid</span><span class="p">:{</span><span class="s s-Atom">pmid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if is_ncbi_url and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">pmc/</span><span class="s2">&quot;):</span>

<span class="s2">        # PubMed Central URLs</span>

<span class="s2">        try:</span>

<span class="s2">            pmcid = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[3]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">pmcid</span><span class="p">:{</span><span class="s s-Atom">pmcid</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if parsed_url.hostname.split(&quot;</span><span class="p">.</span><span class="s2">&quot;)[-2:] == [</span>

<span class="s2">        &quot;</span><span class="s s-Atom">wikidata</span><span class="s2">&quot;,</span>

<span class="s2">        &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;,</span>

<span class="s2">    ] and parsed_url.path.startswith(&quot;</span><span class="o">/</span><span class="s s-Atom">wiki/</span><span class="s2">&quot;):</span>

<span class="s2">        # Wikidata URLs</span>

<span class="s2">        try:</span>

<span class="s2">            wikidata_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;)[2]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">wikidata</span><span class="p">:{</span><span class="s s-Atom">wikidata_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if parsed_url.hostname.split(&quot;</span><span class="p">.</span><span class="s2">&quot;)[-2:] == [&quot;</span><span class="s s-Atom">arxiv</span><span class="s2">&quot;, &quot;</span><span class="s s-Atom">org</span><span class="s2">&quot;]:</span>

<span class="s2">        # arXiv identifiers. See https://arxiv.org/help/arxiv_identifier</span>

<span class="s2">        try:</span>

<span class="s2">            arxiv_id = parsed_url.path.split(&quot;</span><span class="s s-Atom">/</span><span class="s2">&quot;, maxsplit=2)[2]</span>

<span class="s2">            if arxiv_id.endswith(&quot;</span><span class="p">.</span><span class="s s-Atom">pdf</span><span class="s2">&quot;):</span>

<span class="s2">                arxiv_id = arxiv_id[:-4]</span>

<span class="s2">            citekey = f&quot;</span><span class="nn">arxiv</span><span class="p">:{</span><span class="s s-Atom">arxiv_id</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">        except IndexError:</span>

<span class="s2">            pass</span>

<span class="s2">    if citekey is None or inspect_citekey(citekey) is not None:</span>

<span class="s2">        citekey = f&quot;</span><span class="nn">url</span><span class="p">:{</span><span class="s s-Atom">url</span><span class="p">}</span><span class="err">&quot;</span>

    <span class="s s-Atom">return</span> <span class="s s-Atom">citekey</span>
</pre></div>


</details>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cite_command/" title="Cite Command" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cite Command
              </span>
            </div>
          </a>
        
        
          <a href="../citeproc/" title="Citeproc" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Citeproc
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
    
  </body>
</html>